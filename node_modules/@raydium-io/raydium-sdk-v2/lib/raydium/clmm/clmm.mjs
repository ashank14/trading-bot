var Kr=Object.defineProperty,Nr=Object.defineProperties;var Lr=Object.getOwnPropertyDescriptors;var an=Object.getOwnPropertySymbols;var wi=Object.prototype.hasOwnProperty,hi=Object.prototype.propertyIsEnumerable;var yi=(r,e,t)=>e in r?Kr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,F=(r,e)=>{for(var t in e||(e={}))wi.call(e,t)&&yi(r,t,e[t]);if(an)for(var t of an(e))hi.call(e,t)&&yi(r,t,e[t]);return r},j=(r,e)=>Nr(r,Lr(e));var Bt=(r,e)=>{var t={};for(var n in r)wi.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&an)for(var n of an(r))e.indexOf(n)<0&&hi.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as M}from"@solana/web3.js";import Fe from"bn.js";var It=9e15,dt=1e9,On="0123456789abcdef",un="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ln="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",En={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-It,maxE:It,crypto:!1},Ti,nt,G=!0,dn="[DecimalError] ",mt=dn+"Invalid argument: ",xi=dn+"Precision limit exceeded",Bi=dn+"crypto unavailable",Ii="[object Decimal]",Ke=Math.floor,ke=Math.pow,Rr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Mr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Or=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Si=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Xe=1e7,W=7,Er=9007199254740991,Fr=un.length-1,Fn=ln.length-1,I={toStringTag:Ii};I.absoluteValue=I.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),D(r)};I.ceil=function(){return D(new this.constructor(this),this.e+1,2)};I.clampedTo=I.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(mt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};I.comparedTo=I.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,c=o.s,u=r.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==r.e)return o.e>r.e^c<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===i?0:n>i^c<0?1:-1};I.cosine=I.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+W,n.rounding=1,t=vr(n,Ri(n,t)),n.precision=r,n.rounding=e,D(nt==2||nt==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};I.cubeRoot=I.cbrt=function(){var r,e,t,n,i,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(G=!1,o=l.s*ke(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=xe(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ke(t,1/3),r=Ke((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=oe(u.plus(l).times(a),u.plus(c),s+2,1),xe(a.d).slice(0,s)===(t=xe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(D(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(D(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return G=!0,D(n,r,m.rounding,e)};I.decimalPlaces=I.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Ke(this.e/W))*W,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};I.dividedBy=I.div=function(r){return oe(this,new this.constructor(r))};I.dividedToIntegerBy=I.divToInt=function(r){var e=this,t=e.constructor;return D(oe(e,new t(r),0,1,1),t.precision,t.rounding)};I.equals=I.eq=function(r){return this.cmp(r)===0};I.floor=function(){return D(new this.constructor(this),this.e+1,3)};I.greaterThan=I.gt=function(r){return this.cmp(r)>0};I.greaterThanOrEqualTo=I.gte=function(r){var e=this.cmp(r);return e==1||e===0};I.hyperbolicCosine=I.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/pn(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=St(s,1,o.times(e),new s(1),!0);for(var c,u=r,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return D(o,s.precision=t,s.rounding=n,!0)};I.hyperbolicSine=I.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=St(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/pn(5,r)),i=St(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,D(i,e,t,!0)};I.hyperbolicTangent=I.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,oe(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};I.inverseCosine=I.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ge(t,i,o):new t(0):new t(NaN):e.isZero()?Ge(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=Ge(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};I.inverseHyperbolicCosine=I.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,G=!1,t=t.times(t).minus(1).sqrt().plus(t),G=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};I.inverseHyperbolicSine=I.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,G=!1,t=t.times(t).plus(1).sqrt().plus(t),G=!0,n.precision=r,n.rounding=e,t.ln())};I.inverseHyperbolicTangent=I.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?D(new o(i),r,e,!0):(o.precision=t=n-i.e,i=oe(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};I.inverseSine=I.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=Ge(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};I.inverseTangent=I.atan=function(){var r,e,t,n,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,f=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Fn)return s=Ge(l,m+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Fn)return s=Ge(l,m+4,f).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/W+2|0),r=t;r;--r)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(G=!1,e=Math.ceil(a/W),n=1,c=u.times(u),s=new l(u),i=u;r!==-1;)if(i=i.times(c),o=s.minus(i.div(n+=2)),i=i.times(c),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),G=!0,D(s,l.precision=m,l.rounding=f,!0)};I.isFinite=function(){return!!this.d};I.isInteger=I.isInt=function(){return!!this.d&&Ke(this.e/W)>this.d.length-2};I.isNaN=function(){return!this.s};I.isNegative=I.isNeg=function(){return this.s<0};I.isPositive=I.isPos=function(){return this.s>0};I.isZero=function(){return!!this.d&&this.d[0]===0};I.lessThan=I.lt=function(r){return this.cmp(r)<0};I.lessThanOrEqualTo=I.lte=function(r){return this.cmp(r)<1};I.logarithm=I.log=function(r){var e,t,n,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,f=l.rounding,d=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(G=!1,a=m+d,s=lt(u,a),n=e?mn(l,a+10):lt(r,a),c=oe(s,n,a,1),Mt(c.d,i=m,f))do if(a+=10,s=lt(u,a),n=e?mn(l,a+10):lt(r,a),c=oe(s,n,a,1),!o){+xe(c.d).slice(i+1,i+15)+1==1e14&&(c=D(c,m+1,0));break}while(Mt(c.d,i+=10,f));return G=!0,D(c,m,f)};I.minus=I.sub=function(r){var e,t,n,i,o,s,a,c,u,l,m,f,d=this,g=d.constructor;if(r=new g(r),!d.d||!r.d)return!d.s||!r.s?r=new g(NaN):d.d?r.s=-r.s:r=new g(r.d||d.s!==r.s?d:NaN),r;if(d.s!=r.s)return r.s=-r.s,d.plus(r);if(u=d.d,f=r.d,a=g.precision,c=g.rounding,!u[0]||!f[0]){if(f[0])r.s=-r.s;else if(u[0])r=new g(d);else return new g(c===3?-0:0);return G?D(r,a,c):r}if(t=Ke(r.e/W),l=Ke(d.e/W),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=f.length):(e=f,t=l,s=u.length),n=Math.max(Math.ceil(a/W),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=f.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){m=u[n]<f[n];break}o=0}for(m&&(e=u,u=f,f=e,r.s=-r.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>o;){if(u[--n]<f[n]){for(i=n;i&&u[--i]===0;)u[i]=Xe-1;--u[i],u[n]+=Xe}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(r.d=u,r.e=fn(u,t),G?D(r,a,c):r):new g(c===3?-0:0)};I.modulo=I.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?D(new n(t),n.precision,n.rounding):(G=!1,n.modulo==9?(e=oe(t,r.abs(),0,3,1),e.s*=r.s):e=oe(t,r,0,n.modulo,1),e=e.times(r),G=!0,t.minus(e))};I.naturalExponential=I.exp=function(){return vn(this)};I.naturalLogarithm=I.ln=function(){return lt(this)};I.negated=I.neg=function(){var r=new this.constructor(this);return r.s=-r.s,D(r)};I.plus=I.add=function(r){var e,t,n,i,o,s,a,c,u,l,m=this,f=m.constructor;if(r=new f(r),!m.d||!r.d)return!m.s||!r.s?r=new f(NaN):m.d||(r=new f(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(u=m.d,l=r.d,a=f.precision,c=f.rounding,!u[0]||!l[0])return l[0]||(r=new f(m)),G?D(r,a,c):r;if(o=Ke(m.e/W),n=Ke(r.e/W),u=u.slice(),i=o-n,i){for(i<0?(t=u,i=-i,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/W),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,t=l,l=u,u=t),e=0;i;)e=(u[--i]=u[i]+l[i]+e)/Xe|0,u[i]%=Xe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return r.d=u,r.e=fn(u,n),G?D(r,a,c):r};I.precision=I.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(mt+r);return t.d?(e=Ci(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};I.round=function(){var r=this,e=r.constructor;return D(new e(r),r.e+1,e.rounding)};I.sine=I.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+W,n.rounding=1,t=_r(n,Ri(n,t)),n.precision=r,n.rounding=e,D(nt>2?t.neg():t,r,e,!0)):new n(NaN)};I.squareRoot=I.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(G=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=xe(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(oe(s,o,t+2,1)).times(.5),xe(o.d).slice(0,t)===(e=xe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(D(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(D(n,c+1,1),r=!n.times(n).eq(s));break}return G=!0,D(n,c,l.rounding,r)};I.tangent=I.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=oe(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,D(nt==2||nt==4?t.neg():t,r,e,!0)):new n(NaN)};I.times=I.mul=function(r){var e,t,n,i,o,s,a,c,u,l=this,m=l.constructor,f=l.d,d=(r=new m(r)).d;if(r.s*=l.s,!f||!f[0]||!d||!d[0])return new m(!r.s||f&&!f[0]&&!d||d&&!d[0]&&!f?NaN:!f||!d?r.s/0:r.s*0);for(t=Ke(l.e/W)+Ke(r.e/W),c=f.length,u=d.length,c<u&&(o=f,f=d,d=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,i=c+n;i>n;)a=o[i]+d[n]*f[i-n-1]+e,o[i--]=a%Xe|0,e=a/Xe|0;o[i]=(o[i]+e)%Xe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=fn(o,t),G?D(r,m.precision,m.rounding):r};I.toBinary=function(r,e){return _n(this,2,r,e)};I.toDecimalPlaces=I.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ee(r,0,dt),e===void 0?e=n.rounding:Ee(e,0,8),D(t,r+t.e+1,e))};I.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=je(n,!0):(Ee(r,0,dt),e===void 0?e=i.rounding:Ee(e,0,8),n=D(new i(n),r+1,e),t=je(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=je(i):(Ee(r,0,dt),e===void 0?e=o.rounding:Ee(e,0,8),n=D(new o(i),r+i.e+1,e),t=je(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};I.toFraction=function(r){var e,t,n,i,o,s,a,c,u,l,m,f,d=this,g=d.d,p=d.constructor;if(!g)return new p(d);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=Ci(g)-d.e-1,s=o%W,e.d[0]=ke(10,s<0?W+s:s),r==null)r=o>0?e:u;else{if(a=new p(r),!a.isInt()||a.lt(u))throw Error(mt+a);r=a.gt(e)?o>0?e:u:a}for(G=!1,a=new p(xe(g)),l=p.precision,p.precision=o=g.length*W*2;m=oe(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=u,u=c.plus(m.times(i)),c=i,i=e,e=a.minus(m.times(i)),a=i;return i=oe(r.minus(t),n,0,1,1),c=c.plus(i.times(u)),t=t.plus(i.times(n)),c.s=u.s=d.s,f=oe(u,n,o,1).minus(d).abs().cmp(oe(c,t,o,1).minus(d).abs())<1?[u,n]:[c,t],p.precision=l,G=!0,f};I.toHexadecimal=I.toHex=function(r,e){return _n(this,16,r,e)};I.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ee(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(G=!1,t=oe(t,r,0,e,1).times(r),G=!0,D(t)):(r.s=t.s,t=r),t};I.toNumber=function(){return+this};I.toOctal=function(r,e){return _n(this,8,r,e)};I.toPower=I.pow=function(r){var e,t,n,i,o,s,a=this,c=a.constructor,u=+(r=new c(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new c(ke(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,r.eq(1))return D(a,n,o);if(e=Ke(r.e/W),e>=r.d.length-1&&(t=u<0?-u:u)<=Er)return i=Ki(c,a,t,n),r.s<0?new c(1).div(i):D(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new c(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ke(+a,u),e=t==0||!isFinite(t)?Ke(u*(Math.log("0."+xe(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(G=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),i=vn(r.times(lt(a,n+t)),n),i.d&&(i=D(i,n+5,1),Mt(i.d,n,o)&&(e=n+10,i=D(vn(r.times(lt(a,e+t)),e),e+5,1),+xe(i.d).slice(n+1,n+15)+1==1e14&&(i=D(i,n+1,0)))),i.s=s,G=!0,c.rounding=o,D(i,n,o))};I.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=je(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ee(r,1,dt),e===void 0?e=i.rounding:Ee(e,0,8),n=D(new i(n),r,e),t=je(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toSignificantDigits=I.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ee(r,1,dt),e===void 0?e=n.rounding:Ee(e,0,8)),D(new n(t),r,e)};I.toString=function(){var r=this,e=r.constructor,t=je(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};I.truncated=I.trunc=function(){return D(new this.constructor(this),this.e+1,1)};I.valueOf=I.toJSON=function(){var r=this,e=r.constructor,t=je(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function xe(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=W-n.length,t&&(o+=ut(t)),o+=n;s=r[e],n=s+"",t=W-n.length,t&&(o+=ut(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ee(r,e,t){if(r!==~~r||r<e||r>t)throw Error(mt+r)}function Mt(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=W,i=0):(i=Math.ceil((e+1)/W),e%=W),o=ke(10,W-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==ke(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==ke(10,e-3)-1,s}function cn(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=On.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function vr(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/pn(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=St(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var oe=function(){function r(n,i,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*i+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=i[a]){c=n[a]>i[a]?1:-1;break}return c}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,c){var u,l,m,f,d,g,p,y,b,w,h,P,A,k,B,T,x,N,S,K,L=n.constructor,E=n.s==i.s?1:-1,V=n.d,v=i.d;if(!V||!V[0]||!v||!v[0])return new L(!n.s||!i.s||(V?v&&V[0]==v[0]:!v)?NaN:V&&V[0]==0||!v?E*0:E/0);for(c?(d=1,l=n.e-i.e):(c=Xe,d=W,l=Ke(n.e/d)-Ke(i.e/d)),S=v.length,x=V.length,b=new L(E),w=b.d=[],m=0;v[m]==(V[m]||0);m++);if(v[m]>(V[m]||0)&&l--,o==null?(k=o=L.precision,s=L.rounding):a?k=o+(n.e-i.e)+1:k=o,k<0)w.push(1),g=!0;else{if(k=k/d+2|0,m=0,S==1){for(f=0,v=v[0],k++;(m<x||f)&&k--;m++)B=f*c+(V[m]||0),w[m]=B/v|0,f=B%v|0;g=f||m<x}else{for(f=c/(v[0]+1)|0,f>1&&(v=r(v,f,c),V=r(V,f,c),S=v.length,x=V.length),T=S,h=V.slice(0,S),P=h.length;P<S;)h[P++]=0;K=v.slice(),K.unshift(0),N=v[0],v[1]>=c/2&&++N;do f=0,u=e(v,h,S,P),u<0?(A=h[0],S!=P&&(A=A*c+(h[1]||0)),f=A/N|0,f>1?(f>=c&&(f=c-1),p=r(v,f,c),y=p.length,P=h.length,u=e(p,h,y,P),u==1&&(f--,t(p,S<y?K:v,y,c))):(f==0&&(u=f=1),p=v.slice()),y=p.length,y<P&&p.unshift(0),t(h,p,P,c),u==-1&&(P=h.length,u=e(v,h,S,P),u<1&&(f++,t(h,S<P?K:v,P,c))),P=h.length):u===0&&(f++,h=[0]),w[m++]=f,u&&h[0]?h[P++]=V[T]||0:(h=[V[T]],P=1);while((T++<x||h[0]!==void 0)&&k--);g=h[0]!==void 0}w[0]||w.shift()}if(d==1)b.e=l,Ti=g;else{for(m=1,f=w[0];f>=10;f/=10)m++;b.e=m+l*d-1,D(b,a?o+b.e+1:o,s,g)}return b}}();function D(r,e,t,n){var i,o,s,a,c,u,l,m,f,d=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=W,s=e,l=m[f=0],c=l/ke(10,i-s-1)%10|0;else if(f=Math.ceil((o+1)/W),a=m.length,f>=a)if(n){for(;a++<=f;)m.push(0);l=c=0,i=1,o%=W,s=o-W+1}else break e;else{for(l=a=m[f],i=1;a>=10;a/=10)i++;o%=W,s=o-W+i,c=s<0?0:l/ke(10,i-s-1)%10|0}if(n=n||e<0||m[f+1]!==void 0||(s<0?l:l%ke(10,i-s-1)),u=t<4?(c||n)&&(t==0||t==(r.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ke(10,i-s):0:m[f-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=r.e+1,m[0]=ke(10,(W-e%W)%W),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=f,a=1,f--):(m.length=f+1,a=ke(10,W-o),m[f]=s>0?(l/ke(10,i-s)%ke(10,s)|0)*a:0),u)for(;;)if(f==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Xe&&(m[0]=1));break}else{if(m[f]+=a,m[f]!=Xe)break;m[f--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return G&&(r.e>d.maxE?(r.d=null,r.e=NaN):r.e<d.minE&&(r.e=0,r.d=[0])),r}function je(r,e,t){if(!r.isFinite())return Li(r);var n,i=r.e,o=xe(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ut(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+ut(-i-1)+o,t&&(n=t-s)>0&&(o+=ut(n))):i>=s?(o+=ut(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+ut(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=ut(n))),o}function fn(r,e){var t=r[0];for(e*=W;t>=10;t/=10)e++;return e}function mn(r,e,t){if(e>Fr)throw G=!0,t&&(r.precision=t),Error(xi);return D(new r(un),e,1,!0)}function Ge(r,e,t){if(e>Fn)throw Error(xi);return D(new r(ln),e,t,!0)}function Ci(r){var e=r.length-1,t=e*W+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function ut(r){for(var e="";r--;)e+="0";return e}function Ki(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/W+4);for(G=!1;;){if(t%2&&(o=o.times(e),Pi(o.d,s)&&(i=!0)),t=Ke(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Pi(e.d,s)}return G=!0,o}function ki(r){return r.d[r.d.length-1]&1}function Ni(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function vn(r,e){var t,n,i,o,s,a,c,u=0,l=0,m=0,f=r.constructor,d=f.rounding,g=f.precision;if(!r.d||!r.d[0]||r.e>17)return new f(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(G=!1,c=g):c=e,a=new f(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(ke(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new f(1),f.precision=c;;){if(o=D(o.times(r),c,1),t=t.times(++l),a=s.plus(oe(o,t,c,1)),xe(a.d).slice(0,c)===xe(s.d).slice(0,c)){for(i=m;i--;)s=D(s.times(s),c,1);if(e==null)if(u<3&&Mt(s.d,c-n,d,u))f.precision=c+=10,t=o=a=new f(1),l=0,u++;else return D(s,f.precision=g,d,G=!0);else return f.precision=g,s}s=a}}function lt(r,e){var t,n,i,o,s,a,c,u,l,m,f,d=1,g=10,p=r,y=p.d,b=p.constructor,w=b.rounding,h=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(G=!1,l=h):l=e,b.precision=l+=g,t=xe(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(r),t=xe(p.d),n=t.charAt(0),d++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return u=mn(b,l+2,h).times(o+""),p=lt(new b(n+"."+t.slice(1)),l-g).plus(u),b.precision=h,e==null?D(p,h,w,G=!0):p;for(m=p,c=s=p=oe(p.minus(1),p.plus(1),l,1),f=D(p.times(p),l,1),i=3;;){if(s=D(s.times(f),l,1),u=c.plus(oe(s,new b(i),l,1)),xe(u.d).slice(0,l)===xe(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(mn(b,l+2,h).times(o+""))),c=oe(c,new b(d),l,1),e==null)if(Mt(c.d,l-g,w,a))b.precision=l+=g,u=s=p=oe(m.minus(1),m.plus(1),l,1),f=D(p.times(p),l,1),i=a=1;else return D(c,b.precision=h,w,G=!0);else return b.precision=h,c;c=u,i+=2}}function Li(r){return String(r.s*r.s/0)}function Dn(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%W,t<0&&(n+=W),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=W;n<i;)r.d.push(+e.slice(n,n+=W));e=e.slice(n),n=W-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),G&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Dr(r,e){var t,n,i,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Si.test(e))return Dn(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Mr.test(e))t=16,e=e.toLowerCase();else if(Rr.test(e))t=2;else if(Or.test(e))t=8;else throw Error(mt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ki(n,new n(t),o,o*2)),u=cn(e,t,Xe),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(r.s*0):(r.e=fn(u,l),r.d=u,G=!1,s&&(r=oe(r,i,a*4)),c&&(r=r.times(Math.abs(c)<54?ke(2,c):Ot.pow(2,c))),G=!0,r)}function _r(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:St(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/pn(5,t)),e=St(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function St(r,e,t,n,i){var o,s,a,c,u=1,l=r.precision,m=Math.ceil(l/W);for(G=!1,c=t.times(t),a=new r(n);;){if(s=oe(a.times(c),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=oe(s.times(c),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return G=!0,s.d.length=m+1,s}function pn(r,e){for(var t=r;--e;)t*=r;return t}function Ri(r,e){var t,n=e.s<0,i=Ge(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return nt=n?4:1,e;if(t=e.divToInt(i),t.isZero())nt=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return nt=ki(t)?n?2:3:n?4:1,e;nt=ki(t)?n?1:4:n?3:2}return e.minus(i).abs()}function _n(r,e,t,n){var i,o,s,a,c,u,l,m,f,d=r.constructor,g=t!==void 0;if(g?(Ee(t,1,dt),n===void 0?n=d.rounding:Ee(n,0,8)):(t=d.precision,n=d.rounding),!r.isFinite())l=Li(r);else{for(l=je(r),s=l.indexOf("."),g?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),f=new d(1),f.e=l.length-s,f.d=cn(je(f),10,i),f.e=f.d.length),m=cn(l,10,i),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(r=new d(r),r.d=m,r.e=o,r=oe(r,f,t,n,0,i),m=r.d,o=r.e,u=Ti),s=m[t],a=i/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,u)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=On.charAt(m[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=cn(l,i,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=On.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Pi(r,e){if(r.length>e)return r.length=e,!0}function Wr(r){return new this(r).abs()}function qr(r){return new this(r).acos()}function Vr(r){return new this(r).acosh()}function Ur(r,e){return new this(r).plus(e)}function Gr(r){return new this(r).asin()}function Xr(r){return new this(r).asinh()}function Hr(r){return new this(r).atan()}function zr(r){return new this(r).atanh()}function Zr(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=Ge(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?Ge(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=Ge(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(oe(r,e,o,1)),e=Ge(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(oe(r,e,o,1)),t}function jr(r){return new this(r).cbrt()}function Yr(r){return D(r=new this(r),r.e+1,2)}function Qr(r,e,t){return new this(r).clamp(e,t)}function Jr(r){if(!r||typeof r!="object")throw Error(dn+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,dt,"rounding",0,8,"toExpNeg",-It,0,"toExpPos",0,It,"maxE",0,It,"minE",-It,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=En[t]),(n=r[t])!==void 0)if(Ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(mt+t+": "+n);if(t="crypto",i&&(this[t]=En[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Bi);else this[t]=!1;else throw Error(mt+t+": "+n);return this}function $r(r){return new this(r).cos()}function eo(r){return new this(r).cosh()}function Mi(r){var e,t,n;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Ai(o)){u.s=o.s,G?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;G?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Dn(u,o.toString())}else if(c!=="string")throw Error(mt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Si.test(o)?Dn(u,o):Dr(u,o)}if(i.prototype=I,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Jr,i.clone=Mi,i.isDecimal=Ai,i.abs=Wr,i.acos=qr,i.acosh=Vr,i.add=Ur,i.asin=Gr,i.asinh=Xr,i.atan=Hr,i.atanh=zr,i.atan2=Zr,i.cbrt=jr,i.ceil=Yr,i.clamp=Qr,i.cos=$r,i.cosh=eo,i.div=to,i.exp=no,i.floor=io,i.hypot=ro,i.ln=oo,i.log=so,i.log10=co,i.log2=ao,i.max=uo,i.min=lo,i.mod=mo,i.mul=fo,i.pow=po,i.random=go,i.round=bo,i.sign=yo,i.sin=wo,i.sinh=ho,i.sqrt=ko,i.sub=Po,i.sum=Ao,i.tan=To,i.tanh=xo,i.trunc=Bo,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function to(r,e){return new this(r).div(e)}function no(r){return new this(r).exp()}function io(r){return D(r=new this(r),r.e+1,3)}function ro(){var r,e,t=new this(0);for(G=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return G=!0,new this(1/0);t=e}return G=!0,t.sqrt()}function Ai(r){return r instanceof Ot||r&&r.toStringTag===Ii||!1}function oo(r){return new this(r).ln()}function so(r,e){return new this(r).log(e)}function ao(r){return new this(r).log(2)}function co(r){return new this(r).log(10)}function uo(){return Ni(this,arguments,"lt")}function lo(){return Ni(this,arguments,"gt")}function mo(r,e){return new this(r).mod(e)}function fo(r,e){return new this(r).mul(e)}function po(r,e){return new this(r).pow(e)}function go(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ee(r,1,dt),n=Math.ceil(r/W),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Bi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=W,n&&r&&(i=ke(10,W-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=W)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<W&&(t-=W-n)}return s.e=t,s.d=a,s}function bo(r){return D(r=new this(r),r.e+1,this.rounding)}function yo(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function wo(r){return new this(r).sin()}function ho(r){return new this(r).sinh()}function ko(r){return new this(r).sqrt()}function Po(r,e){return new this(r).sub(e)}function Ao(){var r=0,e=arguments,t=new this(e[r]);for(G=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return G=!0,D(t,this.precision,this.rounding)}function To(r){return new this(r).tan()}function xo(r){return new this(r).tanh()}function Bo(r){return D(r=new this(r),r.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString;I[Symbol.toStringTag]="Decimal";var Ot=I.constructor=Mi(En);un=new Ot(un);ln=new Ot(ln);var R=Ot;import{PublicKey as Fi}from"@solana/web3.js";import{get as Oi,set as Io}from"lodash";var Wn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ei={},So={};function Be(r){let e=Oi(Ei,r);if(!e){let t=Oi(So,r);e=new Wn({name:r,logLevel:t}),Io(Ei,r,e)}return e}import{MINT_SIZE as Co,TOKEN_PROGRAM_ID as Ko,getTransferFeeConfig as No,unpackMint as Lo}from"@solana/spl-token";var qn=Be("Raydium_accountInfo_util");async function it(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=F({batchRequest:!1},t),s=Vn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let f=r._buildArgs([m.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),u=Vn(c,10);a=(await(await Promise.all(u.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&qn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(f=>{if(f){let{data:d,executable:g,lamports:p,owner:y,rentEpoch:b}=f;return d.length!==2&&d[1]!=="base64"&&qn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:g,lamports:p,owner:new Fi(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>r.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&qn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function rt(r,e,t){let n=await it(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>j(F({},i),{accountInfo:n[o]}))}async function vi({connection:r,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await rt(r,e.map(c=>({pubkey:yt(c)})),t),i={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Co){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Lo(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);i[c.pubkey.toString()]=j(F({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Ko,feeConfig:(a=No(u))!=null?a:void 0})}return i[Fi.default.toBase58()]=i[ee.toBase58()],i}import ot from"bn.js";import _o from"big.js";import yn from"bn.js";import Ro from"toformat";var Mo=Ro,Et=Mo;import bn from"big.js";import Eo from"bn.js";import Fo from"decimal.js-light";import Ft from"bn.js";var Di=9007199254740991;function Ae(r){let e=Be("Raydium_parseBigNumberish");if(r instanceof Ft)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ft(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Di||r<=-Di)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ft(String(r))):typeof r=="bigint"?new Ft(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ft(0))}var gn=Be("module/fraction"),Un=Et(bn),vt=Et(Fo),vo={[0]:vt.ROUND_DOWN,[1]:vt.ROUND_HALF_UP,[2]:vt.ROUND_UP},Do={[0]:bn.roundDown,[1]:bn.roundHalfUp,[2]:bn.roundUp},te=class{constructor(e,t=new Eo(1)){this.numerator=Ae(e),this.denominator=Ae(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new te(this.denominator,this.numerator)}add(e){let t=e instanceof te?e:new te(Ae(e));return this.denominator.eq(t.denominator)?new te(this.numerator.add(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof te?e:new te(Ae(e));return this.denominator.eq(t.denominator)?new te(this.numerator.sub(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof te?e:new te(Ae(e));return new te(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof te?e:new te(Ae(e));return new te(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||gn.logWithError(`${e} is not an integer.`),e<=0&&gn.logWithError(`${e} is not positive.`),vt.set({precision:e+1,rounding:vo[n]});let i=new vt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||gn.logWithError(`${e} is not an integer.`),e<0&&gn.logWithError(`${e} is negative.`),Un.DP=e,Un.RM=Do[n]||1,new Un(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Wo=Be("Raydium_amount"),_i=Et(_o);function qo(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Wo.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var Ie=class extends te{constructor(t,n,i=!0,o){let s=new yn(0),a=Gn.pow(new yn(t.decimals));if(i)s=Ae(n);else{let c=new yn(0),u=new yn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=qo(n.toString(),t.decimals);c=Ae(l),u=Ae(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Be(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Ie(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Ie(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return _i.DP=this.token.decimals,new _i(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Vo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wi}from"@solana/spl-token";var Xn={chainId:101,address:Vo.default.toBase58(),programId:Wi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ft={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Wi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as jn}from"@solana/web3.js";import{PublicKey as me,SystemProgram as qi,SYSVAR_RENT_PUBKEY as Uo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Go}from"@solana/spl-token";function Hn({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ta=[Hn({pubkey:Go,isWritable:!1}),Hn({pubkey:qi.programId,isWritable:!1}),Hn({pubkey:Uo,isWritable:!1})];function zn({publicKey:r,transformSol:e}){let t=Vi(r.toString());if(t instanceof me)return e&&t.equals(Dt)?ee:t;if(e&&t.toString()===Dt.toBase58())return ee;if(typeof t=="string"){if(t===me.default.toBase58())return me.default;try{return new me(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Vi(r){try{return new me(r)}catch{return r}}var wn=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Zn=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pt=new me("SysvarRent111111111111111111111111111111111"),xa=new me("SysvarC1ock11111111111111111111111111111111"),wt=new me("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ba=new me("Sysvar1nstructions1111111111111111111111111"),Ia=qi.programId,Sa=new me("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ca=new me("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ka=new me("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Na=new me("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),La=new me("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ra=new me("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ma=new me("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Oa=new me("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ea=new me("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Fa=new me("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),va=new me("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ee=new me("So11111111111111111111111111111111111111112"),Dt=me.default;function yt(r){return zn({publicKey:r,transformSol:!0})}var Yn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Dt.toBase58()||e instanceof jn&&Dt.equals(e)){this.decimals=ft.decimals,this.symbol=ft.symbol,this.name=ft.name,this.mint=new jn(ft.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?jn.default:zn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ye=Yn;Ye.WSOL=new Yn(j(F({},ft),{mint:ft.address}));var Qn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},hn=Qn;hn.SOL=new Qn(Xn);import Xo from"bn.js";var Ui=new te(new Xo(100)),gt=class extends te{toSignificant(e=5,t,n){return this.mul(Ui).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ui).toFixed(e,t,n)}};var Ho=Be("Raydium_price"),He=class extends te{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new te(Jn(n.decimals),Jn(i.decimals))}get raw(){return new te(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new He({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ho.logWithError("mul token not equals");let n=super.mul(t);return new He({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as gc}from"@solana/web3.js";import yc from"bn.js";var zo=new ot(0),Ec=new ot(1),Fc=new ot(2),vc=new ot(3),Dc=new ot(5),Gn=new ot(10),_c=new ot(100),Wc=new ot(1e3),qc=new ot(1e4);function Jn(r){return Gn.pow(Ae(r))}function Vn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ts}from"@solana/spl-token";import{ComputeBudgetProgram as Gi,Keypair as Hi,PublicKey as Zo,Transaction as zi,TransactionMessage as jo,VersionedTransaction as Zi}from"@solana/web3.js";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Yo}from"@solana/spl-token";var Xi=Be("Raydium_txUtil"),ji=1644;function kn(r){let e=[],t=[];return r.microLamports&&(e.push(Gi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(se.SetComputeUnitPrice)),r.units&&(e.push(Gi.setComputeUnitLimit({units:r.units})),t.push(se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ct(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Pn(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(Object.assign(o.err,{txId:e}))},"confirmed")})}function Qo(r,e){r.length<1&&Xi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Xi.logWithError(`no signers provided:, ${e.toString()}`);let t=new zi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ji}catch{return!1}}function Le(r,e){let[t,n]=Zo.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function _t({instructions:r,payer:e,signers:t}){return Qo(r,[e,...t])}function Wt({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Hi.generate().publicKey.toString()}){let o=new jo({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Zi(o).serialize()).toString("base64").length<ji}catch{return!1}}var Jo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),$o=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Zi&&(e=Jo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ht(r){let e=[];return r.forEach(t=>{t instanceof zi&&(t.recentBlockhash||(t.recentBlockhash=Yo.toBase58()),t.feePayer||(t.feePayer=Hi.generate().publicKey)),e.push($o(t))}),console.log("simulate tx string:",e),e}function ae(r,e,t){return Le([r.toBuffer(),(t!=null?t:ts).toBuffer(),e.toBuffer()],new es("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as z}from"@solana/web3.js";var cu=new z("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),uu=new z("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),lu=new z("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),mu=new z("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),du=new z("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),fu=new z("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),pu=new z("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),gu=new z("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),bu=new z("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yu=new z("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),qt=new z("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Vt=new z("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),An=new z("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),wu=new z("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),hu=new z("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ku=new z("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Pu=new z("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Au=new z("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Tu=new z("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),xu=new z("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bu=new z("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Iu=new z("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ns=new z("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),is=new z("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),rs=new z("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Su=new z("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),os=new z("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Cu=new z("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ss=new z("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Ku={SERUM_MARKET:z.default,OPENBOOK_MARKET:new z("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:z.default,FarmV3:new z("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new z("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new z("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new z("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new z("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new z("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new z("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new z("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new z("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ns,CREATE_CPMM_POOL_AUTH:is,CREATE_CPMM_POOL_FEE_ACC:rs,FEE_DESTINATION_ID:new z("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:os,LCOK_CPMM_AUTH:ss};import ze from"bn.js";var Ut=1e4;function ye(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=j(F({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new ze(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ut){let c=new ze(o.maximumFee.toString());return{amount:r.add(c),fee:c,expirationTime:a}}else{let c=$n(r.mul(new ze(Ut)),new ze(Ut-o.transferFeeBasisPoints)),u=new ze(o.maximumFee.toString()),l=c.sub(r).gt(u)?r.add(u):c,m=$n(l.mul(new ze(o.transferFeeBasisPoints)),new ze(Ut)),f=m.gt(s)?s:m;return{amount:l,fee:f,expirationTime:a}}else{let c=$n(r.mul(new ze(o.transferFeeBasisPoints)),new ze(Ut)),u=c.gt(s)?s:c;return{amount:r,fee:u,expirationTime:a}}}function bt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function $n(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new ze(0))?t.add(new ze(1)):t}import{PublicKey as Yi,AddressLookupTableAccount as Tn}from"@solana/web3.js";async function ei({connection:r,address:e}){let t=await it(r,[...new Set(e.map(i=>i.toString()))].map(i=>new Yi(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new Tn({key:s,state:Tn.deserialize(o.data)});n[s.toString()]=a,xn[s.toString()]=a}return n}var xn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Tn({key:new Yi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Tn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Kt,sendAndConfirmTransaction as ti,SystemProgram as cs,Transaction as Gt,TransactionMessage as Xt,VersionedTransaction as Ht}from"@solana/web3.js";import us from"axios";var Bn=2e3,In=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await us.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=kn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(cs.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Kt(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(se.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Kt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(F({},t||{})):this.build(t)}build(e){var n;let t=new Gt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},c=o!=null?o:await Ct(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),ht([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await ti(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);if(this.signers.length)for(let m of l)try{m.sign(...this.signers)}catch{}return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var b;let{sequentially:m,onTxUpdate:f,skipTxCount:d=0,recentBlockHash:g,skipPreflight:p=!0}=l||{},y=g!=null?g:await Ct(this.connection,this.blockhashCommitment);if((b=this.owner)!=null&&b.isKeyPair){if(m){let w=[],h=0;for(let P of s){if(++h,h<=d)continue;let A=await ti(this.connection,P,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p});w.push(A)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=y,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:p})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((P,A)=>(P.recentBlockhash=y,a[A].length&&P.sign(...a[A]),P));ht(w);let h=await this.signAllTransactions(w);if(m){let P=0,A=[],k=async()=>{if(!h[P])return;let B=await this.connection.sendRawTransaction(h[P].serialize(),{skipPreflight:p});A.push({txId:B,status:"sent",signedTx:h[P]}),f==null||f([...A]),P++;let T=!1,x=null,N=null,S=K=>{x!==null&&clearInterval(x),N!==null&&this.connection.removeSignatureListener(N);let L=A.findIndex(E=>E.txId===B);if(L>-1){if(A[L].status==="error"||A[L].status==="success")return;A[L].status=K.err?"error":"success"}f==null||f([...A]),K.err||k()};this.loopMultiTxStatus&&(x=setInterval(async()=>{var K;if(T){clearInterval(x);return}try{let L=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(T=!0,clearInterval(x),S({err:((K=L.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",B))}catch(L){T=!0,clearInterval(x),console.error("getTransaction timeout:",L,B)}},Bn)),N=this.connection.onSignature(B,K=>{if(T){this.connection.removeSignatureListener(N);return}T=!0,S(K)},"confirmed"),this.connection.getSignatureStatus(B)};return await k(),{txIds:A.map(B=>B.txId),signedTxs:h}}else{let P=[];for(let A=0;A<h.length;A+=1){let k=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:p});P.push(k)}return{txIds:P,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var p;let g=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=g,s=Bt(g,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=F(F({},this.cluster==="devnet"?{}:xn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Kt(y));let l=await ei({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=i?Kt.default.toBase58():o!=null?o:await Ct(this.connection,this.blockhashCommitment),f=new Xt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((p=this.owner)==null?void 0:p.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ht(f);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var h;let{skipPreflight:b=!0,sendAndConfirm:w}=y||{};if(ht([d]),(h=this.owner)!=null&&h.isKeyPair){let P=await this.connection.sendTransaction(d,{skipPreflight:b});return w&&await Pn(this.connection,P),{txId:P,signedTx:d}}if(this.signAllTransactions){let P=await this.signAllTransactions([d]);if(this.signers.length)for(let A of P)try{A.sign(this.signers)}catch{}return{txId:await this.connection.sendTransaction(P[0],{skipPreflight:b}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var p;let{sequentially:m,onTxUpdate:f,recentBlockHash:d,skipPreflight:g=!0}=l||{};if(d&&s.forEach(y=>y.message.recentBlockhash=d),ht(s),(p=this.owner)!=null&&p.isKeyPair){if(m){let y=[];for(let b of s){let w=await this.connection.sendTransaction(b,{skipPreflight:g});await Pn(this.connection,w),y.push(w)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,w=[],h=async()=>{if(!y[b])return;let P=await this.connection.sendTransaction(y[b],{skipPreflight:g});w.push({txId:P,status:"sent",signedTx:y[b]}),f==null||f([...w]),b++;let A=!1,k=null,B=null,T=x=>{k!==null&&clearInterval(k),B!==null&&this.connection.removeSignatureListener(B);let N=w.findIndex(S=>S.txId===P);if(N>-1){if(w[N].status==="error"||w[N].status==="success")return;w[N].status=x.err?"error":"success"}f==null||f([...w]),x.err||h()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var x;if(A){clearInterval(k);return}try{let N=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(A=!0,clearInterval(k),T({err:((x=N.meta)==null?void 0:x.err)||null}),console.log("tx status from getTransaction:",P))}catch(N){A=!0,clearInterval(k),console.error("getTransaction timeout:",N,P)}},Bn)),B=this.connection.onSignature(P,x=>{if(A){this.connection.removeSignatureListener(B);return}A=!0,T(x)},"confirmed"),this.connection.getSignatureStatus(P)};return h(),{txIds:[],signedTxs:y}}else{let b=[];for(let w=0;w<y.length;w+=1){let h=await this.connection.sendTransaction(y[w],{skipPreflight:g});b.push(h)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var f;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=Bt(m,["splitIns","computeBudgetConfig"]),o=n?kn(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((d,g)=>j(F({},d),{[g.publicKey.toBase58()]:g}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(d=>{let g=[...u,d],p=n?[...o.instructions,...g]:g,b=[...new Set(g.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>new Kt(w));if(d!==t[l]&&u.length<12&&(_t({instructions:p,payer:this.feePayer,signers:b})||_t({instructions:g,payer:this.feePayer,signers:b})))u.push(d);else{if(u.length===0)throw Error("item ins too big");l+=d===t[l]?1:0,_t({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b})?a.push(new Gt().add(...o.instructions,...u)):a.push(new Gt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[d]}}),u.length>0){let g=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>s[p]).filter(p=>p!==void 0);_t({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:g.map(p=>p.publicKey)})?a.push(new Gt().add(...o.instructions,...u)):a.push(new Gt().add(...u)),c.push(g)}return a.forEach(d=>d.feePayer=this.feePayer),(f=this.owner)!=null&&f.signer&&c.forEach(d=>{d.some(g=>g.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async d=>{var P;let{sequentially:g,onTxUpdate:p,skipTxCount:y=0,recentBlockHash:b,skipPreflight:w=!0}=d||{},h=b!=null?b:await Ct(this.connection,this.blockhashCommitment);if(a.forEach(async(A,k)=>{A.recentBlockhash=h,c[k].length&&A.sign(...c[k])}),ht(a),(P=this.owner)!=null&&P.isKeyPair){if(g){let A=0,k=[];for(let B of a){if(++A,A<=y){k.push("tx skipped");continue}let T=await ti(this.connection,B,this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});k.push(T)}return{txIds:k,signedTxs:a}}return{txIds:await Promise.all(a.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let A=await this.signAllTransactions(a.slice(y,a.length)),k=[...a.slice(0,y),...A];if(g){let B=0,T=[],x=async()=>{if(!k[B])return;B<y&&(T.push({txId:"",status:"success",signedTx:k[B]}),p==null||p([...T]),B++,x());let N=await this.connection.sendRawTransaction(k[B].serialize(),{skipPreflight:w});T.push({txId:N,status:"sent",signedTx:k[B]}),p==null||p([...T]),B++;let S=!1,K=null,L=null,E=V=>{K!==null&&clearInterval(K),L!==null&&this.connection.removeSignatureListener(L);let v=T.findIndex(Ce=>Ce.txId===N);if(v>-1){if(T[v].status==="error"||T[v].status==="success")return;T[v].status=V.err?"error":"success"}p==null||p([...T]),V.err||x()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var V;if(S){clearInterval(K);return}try{let v=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});v&&(S=!0,clearInterval(K),E({err:((V=v.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",N))}catch(v){S=!0,clearInterval(K),console.error("getTransaction timeout:",v,N)}},Bn)),L=this.connection.onSignature(N,V=>{if(S){this.connection.removeSignatureListener(L);return}S=!0,E(V)},"confirmed"),this.connection.getSignatureStatus(N)};return await x(),{txIds:T.map(N=>N.txId),signedTxs:k}}else{let B=[];for(let T=0;T<k.length;T+=1){let x=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:w});B.push(x)}return{txIds:B,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var h;let w=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=w,s=Bt(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=F(F({},this.cluster==="devnet"?{}:xn),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let P of c)a[P]===void 0&&u.push(new Kt(P));let l=await ei({connection:this.connection,address:u});for(let[P,A]of Object.entries(l))a[P]=A;let m=t?kn(t):{instructions:[],instructionTypes:[]},f=await Ct(this.connection,this.blockhashCommitment),d=this.signers.reduce((P,A)=>j(F({},P),{[A.publicKey.toBase58()]:A}),{}),g=[],p=[],y=[],b=0;if(this.allInstructions.forEach(P=>{let A=[...y,P],k=t?[...m.instructions,...A]:A;if(P!==n[b]&&y.length<12&&(Wt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:a})||Wt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(P);else{if(y.length===0)throw Error("item ins too big");b+=P===n[b]?1:0;let B={};for(let T of[...new Set(c)])a[T]!==void 0&&(B[T]=a[T]);if(t&&Wt({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:f})){let T=new Xt({payerKey:this.feePayer,recentBlockhash:f,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));g.push(new Ht(T))}else{let T=new Xt({payerKey:this.feePayer,recentBlockhash:f,instructions:[...y]}).compileToV0Message(Object.values(a));g.push(new Ht(T))}p.push(Array.from(new Set(y.map(T=>T.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(T=>d[T]).filter(T=>T!==void 0)),y=[P]}}),y.length>0){let A=[...new Set(y.map(k=>k.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&Wt({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:f})){let k=new Xt({payerKey:this.feePayer,recentBlockhash:f,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));g.push(new Ht(k))}else{let k=new Xt({payerKey:this.feePayer,recentBlockhash:f,instructions:[...y]}).compileToV0Message(Object.values(a));g.push(new Ht(k))}p.push(A)}return(h=this.owner)!=null&&h.signer&&p.forEach(P=>{P.some(A=>A.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:g,buildProps:e,signers:p,instructionTypes:this.instructionTypes,execute:async P=>{var N;let{sequentially:A,onTxUpdate:k,skipTxCount:B=0,recentBlockHash:T,skipPreflight:x=!0}=P||{};if(g.map(async(S,K)=>{p[K].length&&S.sign(p[K]),T&&(S.message.recentBlockhash=T)}),ht(g),(N=this.owner)!=null&&N.isKeyPair){if(A){let S=0,K=[];for(let L of g){if(++S,S<=B){console.log("skip tx: ",S),K.push("tx skipped");continue}let E=await this.connection.sendTransaction(L,{skipPreflight:x});await Pn(this.connection,E),K.push(E)}return{txIds:K,signedTxs:g}}return{txIds:await Promise.all(g.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:x}))),signedTxs:g}}if(this.signAllTransactions){let S=await this.signAllTransactions(g.slice(B,g.length)),K=[...g.slice(0,B),...S];if(A){let L=0,E=[],V=async()=>{if(!K[L])return;if(L<B){E.push({txId:"",status:"success",signedTx:K[L]}),k==null||k([...E]),L++,V();return}let v=await this.connection.sendTransaction(K[L],{skipPreflight:x});E.push({txId:v,status:"sent",signedTx:K[L]}),k==null||k([...E]),L++;let Ce=!1,ve=null,tt=null,Tt=he=>{ve!==null&&clearInterval(ve),tt!==null&&this.connection.removeSignatureListener(tt);let De=E.findIndex(xt=>xt.txId===v);if(De>-1){if(E[De].status==="error"||E[De].status==="success")return;E[De].status=he.err?"error":"success"}k==null||k([...E]),he.err||V()};this.loopMultiTxStatus&&(ve=setInterval(async()=>{var he;if(Ce){clearInterval(ve);return}try{let De=await this.connection.getTransaction(v,{commitment:"confirmed",maxSupportedTransactionVersion:0});De&&(Ce=!0,clearInterval(ve),Tt({err:((he=De.meta)==null?void 0:he.err)||null}),console.log("tx status from getTransaction:",v))}catch(De){Ce=!0,clearInterval(ve),console.error("getTransaction timeout:",De,v)}},Bn)),tt=this.connection.onSignature(v,he=>{if(Ce){this.connection.removeSignatureListener(tt);return}Ce=!0,Tt(he)},"confirmed"),this.connection.getSignatureStatus(v)};return V(),{txIds:[],signedTxs:K}}else{let L=[];for(let E=0;E<K.length;E+=1){let V=await this.connection.sendTransaction(K[E],{skipPreflight:x});L.push(V)}return{txIds:L,signedTxs:K}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{AccountLayout as Ir,TOKEN_2022_PROGRAM_ID as Rt,TOKEN_PROGRAM_ID as sn}from"@solana/spl-token";import{PublicKey as gl}from"@solana/web3.js";import{MintLayout as yl,TOKEN_PROGRAM_ID as hl}from"@solana/spl-token";var Sn=i=>{var o=i,{address:r,programId:e,decimals:t}=o,n=Bt(o,["address","programId","decimals"]);return F({chainId:101,address:yt(r).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},ni=r=>r?j(F({},r),{transferFeeConfigAuthority:r.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:r.withdrawWithheldAuthority.toBase58(),withheldAmount:r.withheldAmount.toString(),olderTransferFee:j(F({},r.olderTransferFee),{epoch:r.olderTransferFee.epoch.toString(),maximumFee:r.olderTransferFee.maximumFee.toString()}),newerTransferFee:j(F({},r.newerTransferFee),{epoch:r.newerTransferFee.epoch.toString(),maximumFee:r.newerTransferFee.maximumFee.toString()})}):void 0;var ii=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),zt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Be(t)}createTxBuilder(e){return this.scope.checkOwner(),new In({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(ii(e))}logInfo(...e){this.logger.info(ii(e))}logAndCreateError(...e){let t=ii(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as Mn,PublicKey as C,SystemProgram as ct,TransactionInstruction as Se}from"@solana/web3.js";import gi from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as on,TOKEN_2022_PROGRAM_ID as be,TOKEN_PROGRAM_ID as ie}from"@solana/spl-token";import{PublicKey as ws}from"@solana/web3.js";import er,{isBN as tr}from"bn.js";import{bits as Nl,BitStructure as Ll,blob as ls,Blob as Rl,cstr as Ml,f32 as Ol,f32be as El,f64 as Fl,f64be as vl,greedy as Dl,Layout as ms,ns64 as _l,ns64be as Wl,nu64 as ql,nu64be as Vl,offset as Ul,s16 as Gl,s16be as Xl,s24 as Hl,s24be as zl,s32 as ds,s32be as Zl,s40 as jl,s40be as Yl,s48 as Ql,s48be as Jl,s8 as $l,seq as fs,struct as em,Structure as ps,u16 as gs,u16be as tm,u24 as nm,u24be as im,u32 as rm,u32be as om,u40 as sm,u40be as am,u48 as cm,u48be as um,u8 as bs,UInt as ys,union as lm,Union as mm,unionLayoutDiscriminator as dm,utf8 as fm}from"@solana/buffer-layout";var ri=ms,Qi=ps;var oi=ys;var Ji=bs,Zt=gs;var ce=ds;var $i=fs;var _e=ls;var Nt=class extends ri{constructor(t,n,i){super(t,i);this.blob=_e(t),this.signed=n}decode(t,n=0){let i=new er(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new er(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function ge(r){return new oi(1,r)}function Lt(r){return new oi(4,r)}function _(r){return new Nt(8,!1,r)}function Y(r){return new Nt(16,!1,r)}function nr(r){return new Nt(8,!0,r)}function ir(r){return new Nt(16,!0,r)}var Cn=class extends ri{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function re(r){return new Cn(_e(32),e=>new ws(e),e=>e.toBuffer(),r)}function Re(r){return new Cn(Ji(),hs,ks,r)}function hs(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function ks(r){return r?1:0}var si=class extends Qi{decode(e,t){return super.decode(e,t)}};function ne(r,e,t){return new si(r,e,t)}function de(r,e,t){let n,i=typeof e=="number"?e:tr(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=tr(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return $i(r,i,t)}import Ns from"bn.js";import Ue from"bn.js";var fe=new Ue(0),Qe=new Ue(1),st=new Ue(-1),We=new Ue(1).shln(64),Kn=new Ue(1).shln(128),ai=We.sub(Qe),jt=64,rr=Kn.subn(1),Ne=-443636,Me=-Ne,Je=new Ue("4295048016"),$e=new Ue("79226673521066979257578248091"),Sm=new Ue("4295048017"),Cm=new Ue("79226673521066979257578248090"),or=16,sr="59543866431248",ar="184467440737095516",cr="15793534762490258745",Nn=new Ue(10).pow(new Ue(6));var ur={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Km=new Ue("18446744073700000000");import Z from"bn.js";function Ln(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function ci(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function ui(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function Yt(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function lr(r,e){return Yt(r,e)?null:ci(r,e)}function mr(r,e){return Yt(r,e)?null:ui(r,e)}var Em=Buffer.from("amm_config","utf8"),Ps=Buffer.from("pool","utf8"),As=Buffer.from("pool_vault","utf8"),Ts=Buffer.from("pool_reward_vault","utf8"),dr=Buffer.from("position","utf8"),xs=Buffer.from("tick_array","utf8"),Bs=Buffer.from("operation","utf8"),Is=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ss=Buffer.from("observation","utf8");function fr(r,e,t,n){return Le([Ps,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function li(r,e,t){return Le([As,e.toBuffer(),t.toBuffer()],r)}function pr(r,e,t){return Le([Ts,e.toBuffer(),t.toBuffer()],r)}function Q(r,e,t){return Le([xs,e.toBuffer(),Ln(t)],r)}function Ze(r,e,t,n){return Le([dr,e.toBuffer(),Ln(t),Ln(n)],r)}function Oe(r,e){return Le([dr,e.toBuffer()],r)}function Qt(r){return Le([Buffer.from("metadata","utf8"),wt.toBuffer(),r.toBuffer()],wt)}function Jt(r){return Le([Bs],r)}function we(r,e){return Le([Is,e.toBuffer()],r)}function gr(r,e){return Le([Ss,e.toBuffer()],r)}var br=Buffer.from("locked_position","utf8");function mi(r,e){return Le([br,e.toBuffer()],r)}function $t(r,e){return Le([br,e.toBuffer()],r)}import{PublicKey as qe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as yr}from"@solana/spl-token";import ue from"bn.js";import et from"bn.js";var en=class{static getfeeGrowthInside(e,t,n){let i=new et(0),o=new et(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new et(0),a=new et(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),u=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=U.wrappingSubU128(c,u.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,We),f=u.rewardAmountOwed.add(m);o.push(f)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=U.wrappingSubU128(c,u.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,We),f=u.rewardAmountOwed.add(m);o.push(f)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new et(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new et(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new et(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new et(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var y,b,w,h;let a=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),c=q.getSqrtPriceX64FromTick(t.tickLower),u=q.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=$.getAmountsFromLiquidity(a,c,u,n,o),[f,d]=[ye(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ye(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[ye(new et(new R(m.amountA.toString()).mul(l).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),ye(new et(new R(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:f,amountB:d,amountSlippageA:g,amountSlippageB:p,expirationTime:bt(f.expirationTime,d.expirationTime)}}};var Cs=15,J=class{static async getTickArrays(e,t,n,i,o,s,a){let c=[],u=O.getTickArrayStartIndexByTick(i,o),l=O.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Cs/2));for(let d=0;d<l.length;d++){let{publicKey:g}=Q(t,n,l[d]);c.push(g)}let m=(await it(e,c)).map(d=>d!==null?tn.decode(d.data):null),f={};for(let d=0;d<c.length;d++){let g=m[d];g!==null&&(f[g.startTickIndex]=j(F({},g),{address:c[d]}))}return f}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=O.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:f,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,f,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/J.tickCount(t)),a=n?O.searchLowBitFromStart(i,o,s-1,1,t):O.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=Pe-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<Pe;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Q(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=O.getTickArrayStartIndexByTick(i,o),c=Math.floor((i-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let f=u.ticks[c];if(f.liquidityGross.gtn(0)){l=f;break}c=c-1}else for(c=c+1;c<Pe;){let f=u.ticks[c];if(f.liquidityGross.gtn(0)){l=f;break}c=c+1}let{publicKey:m}=Q(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(O.checkIsOutOfBoundary(e)){if(e>Me)return!1;let n=O.getTickArrayStartIndexByTick(Ne,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Pe*e}};var di=14,at=class{static maxTickInTickarrayBitmap(e){return e*Pe*kt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!J.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-J.tickCount(n):t+J.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Pe,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(i){let l=e.shln(1024-u-1),m=lr(1024,l);if(m!==null){let f=(u-m-512)*a;return{isInit:!0,tickIndex:f}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=mr(1024,l);if(m!==null){let f=(u+m-512)*a;return{isInit:!0,tickIndex:f}}else return{isInit:!1,tickIndex:o-J.tickCount(n)}}}},nn=class{static getBitmapOffset(e,t){if(!J.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=at.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=at.maxTickInTickarrayBitmap(e),n=-t;if(Me<=t)throw Error(`extensionTickBoundary check error: ${Me}, ${t}`);if(n<=Ne)throw Error(`extensionTickBoundary check error: ${n}, ${Ne}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:O.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=J.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=at.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let c=O.mergeTickArrayBitmap(e).shln(kt-1-a),u=Yt(512,c)?null:ci(512,c);if(u!==null){let l=t-u*J.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=O.mergeTickArrayBitmap(e).shrn(a),u=Yt(512,c)?null:ui(512,c);if(u!==null){let l=t+u*J.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-J.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%at.maxTickInTickarrayBitmap(t),i=Math.floor(n/J.tickCount(t));return e<0&&n!=0&&(i=kt-i),i}};var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:f,amountCalculated:d,accounts:g,sqrtPriceX64:p,feeAmount:y}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,o,s);return c.push(...g),{allTrade:f,expectedAmountOut:d.mul(st),remainingAccounts:c,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=Q(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:f,sqrtPriceX64:d,feeAmount:g}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(st),u,o);return a.push(...f),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?nn.checkTickArrayIsInit(J.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):O.checkTickArrayIsInitialized(O.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Q(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,J.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Q(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/J.tickCount(e.tickSpacing)),i=t?O.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):O.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=J.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=at.nextInitializedTickArrayStartIndex(O.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=nn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ne||t>Me)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],f=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(f===void 0)throw Error("get new reward mint info error");let d=j(F({},m),{perSecond:U.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new qe(f)});if(d.tokenMint.equals(qe.default))continue;if(n<=d.openTime.toNumber()||i.eq(fe)){s.push(d);continue}let g=new ue(Math.min(d.endTime.toNumber(),n)),p=g.sub(d.lastUpdateTime),y=U.mulDivFloor(p,d.emissionsPerSecondX64,i),b=d.rewardGrowthGlobalX64.add(y),w=U.mulDivFloor(p,d.emissionsPerSecondX64,We),h=d.rewardTotalEmissioned.add(w);s.push(j(F({},d),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:h,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=O.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=at.maxTickInTickarrayBitmap(e),n=-t;return t>Me&&(t=J.getArrayStartIndex(Me,e)+J.tickCount(e)),n<Ne&&(n=J.getArrayStartIndex(Ne,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!J.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/J.tickCount(t)*kt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await rt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=hr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let c of t){let u=O.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=O.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:f}=Q(c.programId,c.id,m);o.push({pubkey:f}),i[f.toString()]=c.id}}let s=await rt(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=i[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=tn.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=j(F({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(f=>f.accountInfo.mint),u=[];for(let f of c)for(let d of s)u.push(Oe(d,f).publicKey);let l=await it(t,u,{batchRequest:i}),m={};for(let f of l){if(f===null)continue;let d=rn.decode(f.data),g=d.poolId.toString(),p=e.find(T=>T.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=O._getTickPriceLegacy({poolInfo:y,tick:d.tickLower,baseIn:!0}),w=O._getTickPriceLegacy({poolInfo:y,tick:d.tickUpper,baseIn:!0}),{amountA:h,amountB:P}=$.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,w.tickSqrtPriceX64,d.liquidity,!1),A=1/(1-Math.sqrt(Math.sqrt(b.price.div(w.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:b.price,priceUpper:w.price,amountA:h,amountB:P,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(T=>j(F({},T),{pendingReward:new ue(0)})),leverage:A,tokenFeeAmountA:new ue(0),tokenFeeAmountB:new ue(0)}];let k=await O.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickLower,p.state.tickSpacing),B=await O.getTickArrayAddressByTick(p.state.programId,d.poolId,d.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=k,m[`${p.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=B}if(o){let f=Object.values(m),d=await it(t,f,{batchRequest:i}),g={};for(let p=0;p<f.length;p++){let y=d[p];if(y===null)continue;let b=f[p].toString();g[b]=tn.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let w=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,h=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,P=g[m[w].toString()],A=g[m[h].toString()],k=P.ticks[O.getTickOffsetInArray(b.tickLower,p.tickSpacing)],B=A.ticks[O.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:T,tokenFeeAmountB:x}=await en.GetPositionFees(p,b,k,B),N=await en.GetPositionRewards(p,b,k,B);b.tokenFeeAmountA=T.gte(new ue(0))?T:new ue(0),b.tokenFeeAmountB=x.gte(new ue(0))?x:new ue(0);for(let S=0;S<N.length;S++)b.rewardInfos[S].pendingReward=N[S].gte(new ue(0))?N[S]:new ue(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new R(0),catchLiquidityInsufficient:c=!1}){var K;let u,l=n.toBase58()===e.mintA.address,[m,f]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new R(0))?u=l?Je.add(new ue(1)):$e.sub(new ue(1)):u=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=ye(o,m,i,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:w}=pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((K=d.fee)!=null?K:fe),u,c),h=ye(p,f,i,!1),P=q.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),A=l?P:new R(1).div(P),k=p.mul(new ue(Math.floor((1-s)*1e10))).div(new ue(1e10)),B=ye(k,f,i,!1),T=l?e.currentPrice:new R(1).div(e.currentPrice),x=new R(A).sub(T).abs(),N=T,S=new gt(new R(x).mul(10**15).toFixed(0),new R(N).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:d,amountOut:h,minAmountOut:B,expirationTime:bt(d.expirationTime,h.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:S,fee:w,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=i.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,f]=[new Ye(j(F({},u),{mint:u.address,isToken2022:u.programId===yr.toBase58()})),new Ye(j(F({},l),{mint:l.address,isToken2022:l.programId===yr.toBase58()}))],{allTrade:d,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:w,executionPrice:h,priceImpact:P,fee:A,remainingAccounts:k,executionPriceX64:B}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new qe(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),T=j(F({},g),{amount:new Ie(m,g.amount),fee:g.fee===void 0?void 0:new Ie(m,g.fee)}),x=j(F({},p),{amount:new Ie(f,p.amount),fee:p.fee===void 0?void 0:new Ie(f,p.fee)}),N=j(F({},y),{amount:new Ie(f,y.amount),fee:y.fee===void 0?void 0:new Ie(f,y.fee)}),S=new He({baseToken:m,denominator:new ue(10).pow(new ue(20+m.decimals)),quoteToken:f,numerator:w.mul(new R(10**(20+f.decimals))).toFixed(0)}),K=new He({baseToken:m,denominator:new ue(10).pow(new ue(20+m.decimals)),quoteToken:f,numerator:h.mul(new R(10**(20+f.decimals))).toFixed(0)}),L=new Ie(m,A);return{allTrade:d,realAmountIn:T,amountOut:x,minAmountOut:N,expirationTime:b,currentPrice:S,executionPrice:K,priceImpact:P,fee:L,remainingAccounts:k,executionPriceX64:B}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new R(0)}){var N;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new R(0))?l=c?$e.sub(new ue(1)):Je.add(new ue(1)):l=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ye(o,u[n.toString()],i,!0),{expectedAmountIn:f,remainingAccounts:d,executionPrice:g,feeAmount:p}=pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((N=m.fee)!=null?N:fe),l),y=c?e.mintB.address:e.mintA.address,b=ye(f,u[y],i,!1),w=q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),h=c?w:new R(1).div(w),P=f.mul(new ue(Math.floor((1+s)*1e10))).div(new ue(1e10)),A=ye(P,u[y],i,!0),k=c?e.currentPrice:new R(1).div(e.currentPrice),B=new R(h).sub(k).abs(),T=k,x=new gt(new R(B).mul(10**15).toFixed(0),new R(T).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:A,realAmountOut:m,expirationTime:bt(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:x,fee:p,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var g,p,y;let o=e[t],s=O.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=O.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,f=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=f/l:f===l?d=l/m:d=l/f*(l/m),{feeApr:o.feeApr*d,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*d,((p=o.rewardApr[1])!=null?p:0)*d,((y=o.rewardApr[2])!=null?y:0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[yt(e.mintA.address).toString()],f=i[yt(e.mintB.address).toString()],d=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!f)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),y=q.getSqrtPriceX64FromTick(s),b=q.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:h}=$.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:A}=$.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),k=new R(w.toString()).div(new R(10).pow(d)).mul(m.value).add(new R(h.toString()).div(new R(10).pow(g)).mul(f.value)),B=new R(P.toString()).div(new R(10).pow(d)).mul(m.value).add(new R(A.toString()).div(new R(10).pow(g)).mul(f.value)),T=new R(1).div(k.add(B)),N=new R(l.volumeFee).mul(365).div(u).mul(T).mul(100).toNumber(),S=3600*24*365,K=e.rewardDefaultInfos.map(L=>{var v,Ce;let E=L.mint.decimals,V=i[L.mint.address];return c<((v=L.startTime)!=null?v:0)||c>((Ce=L.endTime)!=null?Ce:0)||!L.perSecond||!V||E===void 0?0:new R(V.value).mul(new R(L.perSecond).mul(S)).div(new R(10).pow(E)).mul(T).mul(100).toNumber()});return{feeApr:N,rewardsApr:K,apr:N+K.reduce((L,E)=>L+E,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,w;let l=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(n),f=q.getSqrtPriceX64FromTick(i),d=ye(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),g=new ue(new R(d.amount.sub((w=d.fee)!=null?w:fe).toString()).toFixed(0)),p;if(l.lte(m))p=t?$.getLiquidityFromTokenAmountA(m,f,g,!a):new ue(0);else if(l.lte(f)){let h=$.getLiquidityFromTokenAmountA(l,f,g,!a),P=$.getLiquidityFromTokenAmountB(m,l,g);p=t?h:P}else p=t?new ue(0):$.getLiquidityFromTokenAmountB(m,f,g);let y=await pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:i,liquidity:p,slippage:s,add:a});return{liquidity:p,amountA:t?d:y.amountA,amountB:t?y.amountB:d,amountSlippageA:t?d:y.amountSlippageA,amountSlippageB:t?y.amountSlippageB:d,expirationTime:y.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var y,b,w,h;let c=q.getSqrtPriceX64FromTick(n),u=q.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=$.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new R(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[f,d]=[ye(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ye(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[ye(m.amountA.muln(l),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),ye(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:f,amountB:d,amountSlippageA:g,amountSlippageB:p,expirationTime:bt(f.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(c=>!n[c.id]).map(c=>new qe(c.id));(await it(e,i)).forEach((c,u)=>{!c||(n[i[u].toBase58()]=Rn.decode(c.data))});let s=t.map(c=>we(new qe(c.programId),new qe(c.id)).publicKey),a=await pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>j(F({},c),{[u.id]:j(F({},n[u.id]),{id:new qe(u.id),version:6,programId:new qe(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:j(F({},u.config),{id:new qe(u.config.id),fundOwner:""}),currentPrice:new R(u.price),exBitmapAccount:we(new qe(u.programId),new qe(u.id)).publicKey,exBitmapInfo:a[we(new qe(u.programId),new qe(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var fi={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function wr(r){return j(F({},r),{type:"Concentrated",programId:r.programId.toString(),id:r.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:r.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:r.ammConfig.tradeFeeRate,openTime:r.startTime.toString(),tvl:0,day:fi,week:fi,month:fi,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:j(F({},r.ammConfig),{id:r.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var U=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(fe)||(o=o.add(Qe)),o}static mulDivFloor(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).add(n.sub(Qe)).div(n)}static x64ToDecimal(e,t){return new R(e.toString()).div(R.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Z(e.mul(R.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Kn).sub(t).mod(Kn)}};function Te(r,e){return pi(r.mul(e),64,256)}function Ks(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function pi(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return U.x64ToDecimal(e).pow(2).mul(R.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return U.decimalToX64(e.mul(R.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(fe))return e;let o=t.shln(jt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?U.mulDivCeil(s,e,a):U.mulDivRoundingUp(s,Qe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return U.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(jt);if(i)return e.add(o.div(t));{let s=U.mulDivRoundingUp(o,Qe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ne||e>Me)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Z("18445821805675395072"):new Z("18446744073709551616");return(t&2)!=0&&(n=Te(n,new Z("18444899583751176192"))),(t&4)!=0&&(n=Te(n,new Z("18443055278223355904"))),(t&8)!=0&&(n=Te(n,new Z("18439367220385607680"))),(t&16)!=0&&(n=Te(n,new Z("18431993317065453568"))),(t&32)!=0&&(n=Te(n,new Z("18417254355718170624"))),(t&64)!=0&&(n=Te(n,new Z("18387811781193609216"))),(t&128)!=0&&(n=Te(n,new Z("18329067761203558400"))),(t&256)!=0&&(n=Te(n,new Z("18212142134806163456"))),(t&512)!=0&&(n=Te(n,new Z("17980523815641700352"))),(t&1024)!=0&&(n=Te(n,new Z("17526086738831433728"))),(t&2048)!=0&&(n=Te(n,new Z("16651378430235570176"))),(t&4096)!=0&&(n=Te(n,new Z("15030750278694412288"))),(t&8192)!=0&&(n=Te(n,new Z("12247334978884435968"))),(t&16384)!=0&&(n=Te(n,new Z("8131365268886854656"))),(t&32768)!=0&&(n=Te(n,new Z("3584323654725218816"))),(t&65536)!=0&&(n=Te(n,new Z("696457651848324352"))),(t&131072)!=0&&(n=Te(n,new Z("26294789957507116"))),(t&262144)!=0&&(n=Te(n,new Z("37481735321082"))),e>0&&(n=rr.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt($e)||e.lt(Je))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Z(t-64),i=Ks(n,32,128),o=new Z("8000000000000000","hex"),s=0,a=new Z(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Z(0))&&s<or;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=i.add(u).mul(new Z(sr)),f=pi(m.sub(new Z(ar)),64,128).toNumber(),d=pi(m.add(new Z(cr)),64,128).toNumber();return f==d?f:q.getSqrtPriceX64FromTick(d).lte(e)?d:f}},At=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=At.getTickWithPriceAndTickspacing(e,t,n,i),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,i)}},$=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(jt),s=t.sub(e);return i?U.mulDivRoundingUp(U.mulDivCeil(o,s,t),Qe,e):U.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");return i?U.mulDivCeil(n,t.sub(e),We):U.mulDivFloor(n,t.sub(e),We)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?U.mulDivRoundingUp(a,Qe,ai):a.shrn(jt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),U.mulDivFloor(n,ai,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return $.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=$.getLiquidityFromTokenAmountA(e,n,i,!1),a=$.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return $.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:$.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new Z(0)};if(e.lt(n)){let s=$.getTokenAmountAFromLiquidity(e,n,i,o),a=$.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new Z(0),amountB:$.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:c,amountB:u}=$.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new Z(new R(c.toString()).mul(l).toFixed(0)),f=new Z(new R(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:f}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,h,P,A;let u=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(t),m=q.getSqrtPriceX64FromTick(n),f=s?1+o:1-o,d=$.getAmountsFromLiquidity(u,l,m,i,s),[g,p]=[ye(d.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),ye(d.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)],[y,b]=[ye(new Z(new R(d.amountA.toString()).mul(f).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,c),ye(new Z(new R(d.amountB.toString()).mul(f).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,c)];return{liquidity:i,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:bt(g.expirationTime,p.expirationTime)}}},Pt=class{static swapCompute(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p=!1){if(f.eq(fe))throw new Error("amountSpecified must not be 0");if(g||(g=s?Je.add(Qe):$e.sub(Qe)),s){if(g.lt(Je))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt($e))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=f.gt(fe),b={amountSpecifiedRemaining:f,amountCalculated:fe,sqrtPriceX64:m,tick:u>d?Math.min(d+J.tickCount(l)-1,u):d,accounts:[],liquidity:c,feeAmount:new Z(0)},w=d,h=n[d],P=0,A=!s&&h.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(fe)&&!b.sqrtPriceX64.eq(g);){P>10;let k={};k.sqrtPriceStartX64=b.sqrtPriceX64;let B=O.nextInitTick(h,b.tick,l,s,A),T=B||null,x=null;if(!(T!=null&&T.liquidityGross.gtn(0))){let S=pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},w,s);if(!S.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}w=S.nextStartIndex;let{publicKey:K}=Q(e,t,w);x=K,h=n[w];try{T=O.firstInitializedTick(h,s)}catch{throw Error("not found next tick info")}}k.tickNext=T.tick,k.initialized=T.liquidityGross.gtn(0),d!==w&&x&&(b.accounts.push(x),d=w),k.tickNext<Ne?k.tickNext=Ne:k.tickNext>Me&&(k.tickNext=Me),k.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(k.tickNext);let N;if(s&&k.sqrtPriceNextX64.lt(g)||!s&&k.sqrtPriceNextX64.gt(g)?N=g:N=k.sqrtPriceNextX64,[b.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=Pt.swapStepCompute(b.sqrtPriceX64,N,b.liquidity,b.amountSpecifiedRemaining,a,s),b.feeAmount=b.feeAmount.add(k.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),b.amountCalculated=b.amountCalculated.sub(k.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(k.amountOut),b.amountCalculated=b.amountCalculated.add(k.amountIn.add(k.feeAmount))),b.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let S=T.liquidityNet;s&&(S=S.mul(st)),b.liquidity=$.addDelta(b.liquidity,S)}A=k.tickNext!=b.tick&&!s&&h.startTickIndex===k.tickNext,b.tick=s?k.tickNext-1:k.tickNext}else if(b.sqrtPriceX64!=k.sqrtPriceStartX64){let S=q.getTickFromSqrtPriceX64(b.sqrtPriceX64);A=S!=b.tick&&!s&&h.startTickIndex===S,b.tick=S}++P}try{let{nextStartIndex:k,isExist:B}=J.nextInitializedTickArray(b.tick,l,s,i,o);B&&d!==k&&(b.accounts.push(Q(e,t,k).publicKey),d=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:fe,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,i,o,s){let a={sqrtPriceX64Next:new Z(0),amountIn:new Z(0),amountOut:new Z(0),feeAmount:new Z(0)},c=i.gte(fe);if(c){let l=U.mulDivFloor(i,Nn.sub(new Z(o.toString())),Nn);a.amountIn=s?$.getTokenAmountAFromLiquidity(t,e,n,!0):$.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,l,s)}else a.amountOut=s?$.getTokenAmountBFromLiquidity(t,e,n,!1):$.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(st).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,i.mul(st),s);let u=t.eq(a.sqrtPriceX64Next);return s?(u&&c||(a.amountIn=$.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),u&&!c||(a.amountOut=$.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=u&&c?a.amountIn:$.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=u&&!c?a.amountOut:$.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!c&&a.amountOut.gt(i.mul(st))&&(a.amountOut=i.mul(st)),c&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=i.sub(a.amountIn):a.feeAmount=U.mulDivCeil(a.amountIn,new Z(o),Nn.sub(new Z(o))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}};var Pe=60,kt=512,O=class{static getTickArrayAddressByTick(e,t,n,i){let o=O.getTickArrayStartIndexByTick(n,i),{publicKey:s}=Q(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=O.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Pe)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=J.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*J.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Pe,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*Pe,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Pe:e+t*Pe}static mergeTickArrayBitmap(e){let t=new Ns(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*Pe));return[...O.searchLowBitFromStart(e,t,s-1,o,n),...O.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return O.searchHightBitFromStart(e,t,-7680,kt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=O.getAllInitializedTickArrayStartIndex(n,i,o);for(let c of a){let{publicKey:u}=Q(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>O.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===i)break}let c=J.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>O.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===i)break}let c=J.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ne||e>Me}static nextInitTick(e,t,n,i,o){if(J.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Pe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Pe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Pe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new R(1).div(t),o=At.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new R(1).div(t),o=At.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}};var kr=ne([_e(8),ge("bump"),Zt("index"),re(""),Lt("protocolFeeRate"),Lt("tradeFeeRate"),Zt("tickSpacing"),de(_(),8,"")]),Ls=ne([Lt("blockTimestamp"),nr("tickCumulative"),de(_(),4)]),Pr=ne([_e(8),Re("initialized"),_("recentEpoch"),Zt("observationIndex"),re("poolId"),de(Ls,100,"observations"),de(_(),4)]),Rs=ne([ge("rewardState"),_("openTime"),_("endTime"),_("lastUpdateTime"),Y("emissionsPerSecondX64"),_("rewardTotalEmissioned"),_("rewardClaimed"),re("tokenMint"),re("tokenVault"),re("creator"),Y("rewardGrowthGlobalX64")]),Rn=ne([_e(8),ge("bump"),re("ammConfig"),re("creator"),re("mintA"),re("mintB"),re("vaultA"),re("vaultB"),re("observationId"),ge("mintDecimalsA"),ge("mintDecimalsB"),Zt("tickSpacing"),Y("liquidity"),Y("sqrtPriceX64"),ce("tickCurrent"),Lt(),Y("feeGrowthGlobalX64A"),Y("feeGrowthGlobalX64B"),_("protocolFeesTokenA"),_("protocolFeesTokenB"),Y("swapInAmountTokenA"),Y("swapOutAmountTokenB"),Y("swapInAmountTokenB"),Y("swapOutAmountTokenA"),ge("status"),de(ge(),7,""),de(Rs,3,"rewardInfos"),de(_(),16,"tickArrayBitmap"),_("totalFeesTokenA"),_("totalFeesClaimedTokenA"),_("totalFeesTokenB"),_("totalFeesClaimedTokenB"),_("fundFeesTokenA"),_("fundFeesTokenB"),_("startTime"),de(_(),15*4-3,"padding")]),Ms=ne([Y("growthInsideLastX64"),_("rewardAmountOwed")]),rn=ne([_e(8),ge("bump"),re("nftMint"),re("poolId"),ce("tickLower"),ce("tickUpper"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),_("tokenFeesOwedA"),_("tokenFeesOwedB"),de(Ms,3,"rewardInfos"),de(_(),8,"")]),Ud=ne([_e(8),ge("bump"),re("poolId"),ce("tickLowerIndex"),ce("tickUpperIndex"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),_("tokenFeesOwedA"),_("tokenFeesOwedB"),de(Y(),3,"rewardGrowthInside"),de(_(),8,"")]),Os=ne([ce("tick"),ir("liquidityNet"),Y("liquidityGross"),Y("feeGrowthOutsideX64A"),Y("feeGrowthOutsideX64B"),de(Y(),3,"rewardGrowthsOutsideX64"),de(Lt(),13,"")]),tn=ne([_e(8),re("poolId"),ce("startTickIndex"),de(Os,Pe,"ticks"),ge("initializedTickCount"),de(ge(),115,"")]),Ar=ne([_e(329),de(re(),100,"whitelistMints")]),hr=ne([_e(8),re("poolId"),de(de(_(),8),di,"positiveTickArrayBitmap"),de(de(_(),8),di,"negativeTickArrayBitmap")]),Gd=ne([_(),ge("bump"),re("owner"),re("poolId"),re("positionId"),re("nftAccount"),de(_(),8)]),Xd=ne([_e(8),ge("bump"),re("lockOwner"),re("poolId"),re("positionId"),re("nftAccount"),re("lockNftMint"),_("recentEpoch"),de(_(),8)]);Pr.span;var Tr=Be("Raydium_Clmm"),Ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},xr=[188,37,179,131,82,150,84,73],Br=[16,72,250,198,14,162,212,19],le=class{static createPoolInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d){let g=ne([Y("sqrtPriceX64"),_("zero")]),p=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1}],y=Buffer.alloc(g.span);g.encode({sqrtPriceX64:d,zero:fe},y);let b=Buffer.from([...Ve.createPool,...y]);return new Se({keys:p,programId:e,data:b})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:a}=e,[c,u]=[new C(i.address),new C(o.address)],{publicKey:l}=fr(t,s,c,u),{publicKey:m}=gr(t,l),{publicKey:f}=li(t,l,c),{publicKey:d}=li(t,l,u),g=we(t,l).publicKey,p=[this.createPoolInstruction(t,l,n,s,m,c,f,new C(i.programId||ie),u,d,new C(o.programId||ie),g,a)];return{signers:[],instructions:p,instructionTypes:[se.CreateAccount,se.ClmmCreatePool],address:{poolId:l,observationId:m,exBitmapAccount:g,mintAVault:f,mintBVault:d},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w,h,P,A,k,B,T,x,N){let S=ne([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),Y("liquidity"),_("amountMaxA"),_("amountMaxB"),Re("withMetadata"),ge("optionBaseFlag"),Re("baseFlag")]),K=[...N?[{pubkey:N,isSigner:!1,isWritable:!0}]:[]],L=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...K],E=Buffer.alloc(S.span);S.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:k,amountMaxA:B,amountMaxB:T,withMetadata:x==="create",baseFlag:!1,optionBaseFlag:0},E);let V=Buffer.from([...Ve.openPosition,...E]);return new Se({keys:L,programId:e,data:V})}static openPositionFromLiquidityInstruction22(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w,h,P,A,k,B,T,x){let N=ne([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),Y("liquidity"),_("amountMaxA"),_("amountMaxB"),Re("withMetadata"),ge("optionBaseFlag"),Re("baseFlag")]),S=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],K=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...S],L=Buffer.alloc(N.span);N.encode({tickLowerIndex:b,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:P,liquidity:A,amountMaxA:k,amountMaxB:B,withMetadata:T==="create",baseFlag:!1,optionBaseFlag:0},L);let E=Buffer.from([...Ve.openPositionWithTokenEx,...L]);return new Se({keys:K,programId:e,data:E})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let f=[],[d,g]=[new C(e.programId),new C(e.id)],p;if(l)p=new C((await l(1))[0]);else{let x=Mn.generate();f.push(x),p=x.publicKey}let y=O.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Q(d,g,y),{publicKey:h}=Q(d,g,b),{publicKey:P}=m?ae(n.wallet,p,be):ae(n.wallet,p,ie),{publicKey:A}=Qt(p),{publicKey:k}=Oe(d,p),{publicKey:B}=Ze(d,g,i,o),T=m?this.openPositionFromLiquidityInstruction22(d,n.feePayer,g,n.wallet,p,P,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),i,o,y,b,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(d,g).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,g,n.wallet,p,P,A,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),i,o,y,b,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(d,g).publicKey:void 0);return{signers:f,instructions:[T],instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:p,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:P,metadataAccount:A,personalPosition:k,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let f=[],[d,g]=[new C(e.programId),new C(e.id)],p;if(l)p=new C((await l(1))[0]);else{let x=Mn.generate();f.push(x),p=x.publicKey}let y=O.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Q(d,g,y),{publicKey:h}=Q(d,g,b),{publicKey:P}=m?ae(n.wallet,p,be):ae(n.wallet,p,ie),{publicKey:A}=Qt(p),{publicKey:k}=Oe(d,p),{publicKey:B}=Ze(d,g,i,o),T=m?this.openPositionFromBaseInstruction22(d,n.feePayer,g,n.wallet,p,P,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),i,o,y,b,u,s,a,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(d,g).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,g,n.wallet,p,P,A,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),i,o,y,b,u,s,a,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(d,g).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:P,metadataAccount:A,personalPosition:k,protocolPosition:B},instructions:[T],signers:f,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w,h,P,A,k,B,T,x,N){let S=ne([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),Y("liquidity"),_("amountMaxA"),_("amountMaxB"),Re("withMetadata"),ge("optionBaseFlag"),Re("baseFlag")]),K=[...N?[{pubkey:N,isSigner:!1,isWritable:!0}]:[]],L=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...K],E=Buffer.alloc(S.span);S.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:new gi(0),amountMaxA:B==="MintA"?T:x,amountMaxB:B==="MintA"?x:T,withMetadata:k==="create",baseFlag:B==="MintA",optionBaseFlag:1},E);let V=Buffer.from([...Ve.openPosition,...E]);return new Se({keys:L,programId:e,data:V})}static openPositionFromBaseInstruction22(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w,h,P,A,k,B,T,x){let N=ne([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),Y("liquidity"),_("amountMaxA"),_("amountMaxB"),Re("withMetadata"),ge("optionBaseFlag"),Re("baseFlag")]),S=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],K=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...S],L=Buffer.alloc(N.span);N.encode({tickLowerIndex:b,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:P,liquidity:new gi(0),amountMaxA:k==="MintA"?B:T,amountMaxB:k==="MintA"?T:B,withMetadata:A==="create",baseFlag:k==="MintA",optionBaseFlag:1},L);let E=Buffer.from([...Ve.openPositionWithTokenEx,...L]);return new Se({keys:K,programId:e,data:E})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let f,d=[];if(l)f=new C((await l(1))[0]);else{let x=Mn.generate();d.push(x),f=x.publicKey}let[g,p]=[new C(e.programId),new C(e.id)],y=O.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=O.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Q(g,p,y),{publicKey:h}=Q(g,p,b),{publicKey:P}=m?ae(n.wallet,f,be):ae(n.wallet,f,ie),{publicKey:A}=Qt(f),{publicKey:k}=Oe(g,f),{publicKey:B}=Ze(g,p,i,o),T=m?this.openPositionFromLiquidityInstruction22(g,n.wallet,p,n.wallet,f,P,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),i,o,y,b,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(g,p).publicKey:void 0):this.openPositionFromLiquidityInstruction(g,n.wallet,p,n.wallet,f,P,A,B,w,h,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),i,o,y,b,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,b])?we(g,p).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:P,metadataAccount:A,personalPosition:k,protocolPosition:B},instructions:[T],signers:d,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o,s){let a=ne([]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:s?be:ie,isSigner:!1,isWritable:!1}],u=Buffer.alloc(a.span);a.encode({},u);let l=Buffer.from([...Ve.closePosition,...u]);return new Se({keys:c,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:o}){let s=new C(e.programId),a=o?ae(n.wallet,i.nftMint,be).publicKey:ae(n.wallet,i.nftMint,ie).publicKey,{publicKey:c}=Oe(s,i.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,i.nftMint,a,c,o)),{address:{positionNftAccount:a,personalPosition:c},signers:[],instructions:u,instructionTypes:[se.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w){let h=ne([Y("liquidity"),_("amountMaxA"),_("amountMaxB"),ge("optionBaseFlag"),Re("baseFlag")]),P=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(h.span);h.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},k);let B=Buffer.from([...Ve.increaseLiquidity,...k]);return new Se({keys:A,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],m=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),f=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(u,l,m),{publicKey:g}=Q(u,l,f),{publicKey:p}=c?ae(i.wallet,n.nftMint,be):ae(i.wallet,n.nftMint,ie),{publicKey:y}=Oe(u,n.nftMint),{publicKey:b}=Ze(u,l,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,i.wallet,p,y,l,b,d,g,i.tokenAccountA,i.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,f])?we(u,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:[w],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],m=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),f=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(u,l,m),{publicKey:g}=Q(u,l,f),{publicKey:p}=c?ae(i.wallet,n.nftMint,be):ae(i.wallet,n.nftMint,ie),{publicKey:y}=Oe(u,n.nftMint),{publicKey:b}=Ze(u,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,p,y,l,b,d,g,i.tokenAccountA,i.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,f])?we(u,l).publicKey:void 0)],signers:[],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w){let h=ne([Y("liquidity"),_("amountMaxA"),_("amountMaxB"),ge("optionBaseFlag"),Re("baseFlag")]),P=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(h.span);h.encode({liquidity:new gi(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},k);let B=Buffer.from([...Ve.increaseLiquidity,...k]);return new Se({keys:A,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b,w,h){let P=ne([Y("liquidity"),_("amountMinA"),_("amountMinB")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...p.map(x=>[{pubkey:x.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],B=Buffer.alloc(P.span);P.encode({liquidity:y,amountMinA:b,amountMinB:w},B);let T=Buffer.from([...Ve.decreaseLiquidity,...B]);return new Se({keys:k,programId:e,data:T})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:c,nft2022:u}){let[l,m]=[new C(e.programId),new C(e.id)],f=O.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=O.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:g}=Q(l,m,f),{publicKey:p}=Q(l,m,d),{publicKey:y}=u?ae(i.wallet,n.nftMint,be):ae(i.wallet,n.nftMint,c),{publicKey:b}=Oe(l,n.nftMint),{publicKey:w}=Ze(l,m,n.tickLower,n.tickUpper),h=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)h.push({poolRewardVault:new C(t.rewardInfos[k].vault),ownerRewardVault:i.rewardAccounts[k],rewardMint:new C(e.rewardDefaultInfos[k].mint.address)});let P=[],A=this.decreaseLiquidityInstruction(l,i.wallet,y,b,m,w,g,p,i.tokenAccountA,i.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),h,o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,d])?we(l,m).publicKey:void 0);return P.push(A),{address:{tickArrayLower:g,tickArrayUpper:p,positionNftAccount:y,personalPosition:b,protocolPosition:w},signers:[],instructions:P,instructionTypes:[se.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,c,u,l,m,f,d,g,p,y,b){let w=ne([_("amount"),_("otherAmountThreshold"),Y("sqrtPriceLimitX64"),Re("isBaseInput")]),h=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],A=Buffer.alloc(w.span);w.encode({amount:d,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},A);let k=Buffer.from([...Ve.swap,...A]);return new Se({keys:P,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new C(e.programId),new C(e.id)],[f,d]=[new C(t.vault.A),new C(t.vault.B)],[g,p]=[new C(e.mintA.address),new C(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,i.wallet,m,new C(e.config.id),y?i.tokenAccountA:i.tokenAccountB,y?i.tokenAccountB:i.tokenAccountA,y?f:d,y?d:f,y?g:p,y?p:g,u,n,s,a,c,!0,we(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new C(e.programId),new C(e.id)],[f,d]=[new C(t.vault.A),new C(t.vault.B)],[g,p]=[new C(e.mintA.address),new C(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,i.wallet,m,new C(e.config.id),y?i.tokenAccountB:i.tokenAccountA,y?i.tokenAccountA:i.tokenAccountB,y?d:f,y?f:d,y?p:g,y?g:p,u,n,s,a,c,!1,we(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,c,u,l,m,f){let d=ne([_("openTime"),_("endTime"),Y("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(d.span);d.encode({openTime:Ae(l),endTime:Ae(m),emissionsPerSecondX64:f},p);let y=Buffer.from([...Ve.initReward,...p]);return new Se({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new C(e.programId),new C(e.id)],a=pr(o,s,i.mint).publicKey,c=Jt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new C(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[se.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,c,u,l,m,f){let d=ne([ge("rewardIndex"),Y("emissionsPerSecondX64"),_("openTime"),_("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(d.span);d.encode({rewardIndex:u,emissionsPerSecondX64:f,openTime:Ae(l),endTime:Ae(m)},p);let y=Buffer.from([...Ve.setRewardEmissions,...p]);return new Se({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new C(e.programId),new C(e.id)],a,c,u;for(let f=0;f<e.rewardDefaultInfos.length;f++)e.rewardDefaultInfos[f].mint.address===i.mint.toString()&&(a=f,c=new C(t.rewardInfos[f].vault),u=new C(t.rewardInfos[f].mint.address));(a===void 0||c===void 0)&&Tr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Jt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new C(e.config.id),n.tokenAccount,c,u,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[se.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let c=ne([ge("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...Ve.collectReward,...l]);return new Se({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new C(e.programId),new C(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,c=new C(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&Tr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,i,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[se.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:c}){let u=[],l;if(c)l=new C((await c(1))[0]);else{let b=Mn.generate();u.push(b),l=b.publicKey}let m=a?ae(o,s,be).publicKey:ae(o,s,ie).publicKey,{publicKey:f}=Oe(n,s),d=$t(e,l).publicKey,g=ae(o,l,ie).publicKey,p=Qt(l).publicKey,y=le.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:f,lockPositionId:d,lockNftMint:l,lockNftAccount:g,metadataAccount:p,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:ae(t,s,a?be:ie).publicKey,positionNftProgram:a?be:ie});return{address:{positionId:f,lockPositionId:d,lockNftAccount:g,lockNftMint:l,positionNftAccount:m,metadataAccount:p},instructions:[y],signers:u,instructionTypes:[se.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:c,authPositionNftAccount:u,positionNftProgram:l,lockPositionId:m,lockNftMint:f,lockNftAccount:d,metadataAccount:g,withMetadata:p}){let y=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:on,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}],b=ne([Re("withMetadata")]),w=Buffer.alloc(b.span);b.encode({withMetadata:p},w);let h=Buffer.from([...xr,...w]);return new Se({keys:y,programId:e,data:h})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=ae(i,o,ie),{publicKey:a}=Oe(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:mi(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}];return new Se({keys:c,programId:e,data:Buffer.from(xr)})}static harvestLockPositionInstruction(e){let[t,n]=[new C(e.poolKeys.programId),new C(e.poolKeys.id)],i=O.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=O.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=Q(t,n,i),{publicKey:a}=Q(t,n,o),{publicKey:c}=ae(e.owner,e.ownerPosition.nftMint,ie),{publicKey:u}=Oe(t,e.ownerPosition.nftMint),{publicKey:l}=Ze(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new C(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new C(e.poolKeys.rewardInfos[g].mint.address)});let f=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:mi(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Zn,isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...f];return new Se({keys:d,programId:e.programId,data:Buffer.from(Br)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:m,vaultA:f,vaultB:d,tickArrayLower:g,tickArrayUpper:p,userVaultA:y,userVaultB:b,mintA:w,mintB:h,rewardAccounts:P,exTickArrayBitmap:A}){let k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...P.map(T=>[{pubkey:T.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Zn,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...k];return new Se({keys:B,programId:e,data:Buffer.from(Br)})}};var Sr=class extends zt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var P;let{programId:t,owner:n=((P=this.scope.owner)==null?void 0:P.publicKey)||M.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,computeBudgetConfig:c,forerunCreate:u,getObserveState:l,txVersion:m,txTipConfig:f,feePayer:d}=e,g=this.createTxBuilder(d),[p,y,b]=new Fe(new M(i.address).toBuffer()).gt(new Fe(new M(o.address).toBuffer()))?[o,i,new R(1).div(a)]:[i,o,a],w=q.priceToSqrtPriceX64(b,p.decimals,y.decimals),h=await le.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:y,ammConfigId:s.id,initialPriceX64:w,forerunCreate:!l&&u});return g.addInstruction(h),g.addCustomComputeBudget(c),g.addTipInstruction(f),g.versionBuild({txVersion:m,extInfo:{address:j(F({},h.address),{observationId:h.address.observationId.toBase58(),exBitmapAccount:h.address.exBitmapAccount.toBase58(),programId:t.toString(),id:h.address.poolId.toString(),mintA:p,mintB:y,openTime:"0",vault:{A:h.address.mintAVault.toString(),B:h.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:F({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:h.address.poolId.toString(),mintA:p,mintB:y,feeRate:s.tradeFeeRate,openTime:"0",programId:t.toString(),price:b.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},ur),forerunCreate:u}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,nft2022:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,withMetadata:f="create",getEphemeralSigners:d,computeBudgetConfig:g,txTipConfig:p,txVersion:y,feePayer:b}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let w=this.createTxBuilder(b),h=null,P=null,A=n.useSOLBalance&&e.mintA.address===ee.toString(),k=n.useSOLBalance&&e.mintB.address===ee.toString(),[B,T]=s==="MintA"?[a,c]:[c,a],{account:x,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new M(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||B.isZero()?{payer:this.scope.ownerPubKey,amount:B}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:l,checkCreateATAOwner:m});x&&(h=x),w.addInstruction(N||{});let{account:S,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new M(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:l,checkCreateATAOwner:m});S&&(P=S),w.addInstruction(K||{}),(!h||!P)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:h==null?void 0:h.toBase58(),ownerTokenAccountB:P==null?void 0:P.toBase58()});let L=t||await this.getClmmPoolKeys(e.id),E=await le.openPositionFromBaseInstructions({poolInfo:e,poolKeys:L,ownerInfo:j(F({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:h,tokenAccountB:P}),tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:f,getEphemeralSigners:d,nft2022:u});return w.addInstruction(E),w.addCustomComputeBudget(g),w.addTipInstruction(p),w.versionBuild({txVersion:y,extInfo:F({},E.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:f,computeBudgetConfig:d,txTipConfig:g,getEphemeralSigners:p,nft2022:y,feePayer:b}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let w=this.createTxBuilder(b),h=null,P=null,A=n.useSOLBalance&&e.mintA.address===ee.toBase58(),k=n.useSOLBalance&&e.mintB.address===ee.toBase58(),{account:B,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new M(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||i.isZero()?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});B&&(h=B),w.addInstruction(T||{});let{account:x,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new M(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:u,checkCreateATAOwner:l});x&&(P=x),w.addInstruction(N||{}),(h===void 0||P===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=t||await this.getClmmPoolKeys(e.id),K=await le.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:S,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:h,tokenAccountB:P},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:p,nft2022:y});return w.addInstruction(K),w.addCustomComputeBudget(d),w.addTipInstruction(g),w.versionBuild({txVersion:f,extInfo:{address:K.address}})}async increasePositionFromLiquidity(e){var N;let{poolInfo:t,poolKeys:n,ownerPosition:i,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txTipConfig:f,txVersion:d,feePayer:g}=e,p=this.createTxBuilder(g),y,b,w=c.useSOLBalance&&t.mintA.address===ee.toString(),h=c.useSOLBalance&&t.mintB.address===ee.toString(),{account:P,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new M(t.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,associatedOnly:w?!1:u,checkCreateATAOwner:l});P&&(y=P),p.addInstruction(A||{});let{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new M(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:u,checkCreateATAOwner:l});k&&(b=k),p.addInstruction(B||{}),!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=n!=null?n:await this.getClmmPoolKeys(t.id),x=le.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b},liquidity:a,amountMaxA:o,amountMaxB:s,nft2022:(N=await this.scope.connection.getAccountInfo(i.nftMint))==null?void 0:N.owner.equals(Rt)});return p.addInstruction(x),p.addCustomComputeBudget(m),p.addTipInstruction(f),p.versionBuild({txVersion:d,extInfo:{address:x.address}})}async increasePositionFromBase(e){var x;let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txTipConfig:m,txVersion:f,feePayer:d}=e,g=this.createTxBuilder(d),p,y,b=a.useSOLBalance&&t.mintA.address===ee.toString(),w=a.useSOLBalance&&t.mintB.address===ee.toString(),{account:h,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new M(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:b||(i==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});h&&(p=h),g.addInstruction(P||{});let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new M(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||(i==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:c,checkCreateATAOwner:u});A&&(y=A),g.addInstruction(k||{}),!p&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=await this.getClmmPoolKeys(t.id),T=le.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:B,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},base:i,baseAmount:o,otherAmountMax:s,nft2022:(x=await this.scope.connection.getAccountInfo(n.nftMint))==null?void 0:x.owner.equals(Rt)});return g.addInstruction(T),g.addCustomComputeBudget(l),g.addTipInstruction(m),g.versionBuild({txVersion:f,extInfo:{address:T.address}})}async decreaseLiquidity(e){var L;let{poolInfo:t,poolKeys:n,ownerPosition:i,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txTipConfig:f,txVersion:d,feePayer:g}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(g),y=o.useSOLBalance&&t.mintA.address===ee.toString(),b=o.useSOLBalance&&t.mintB.address===ee.toString(),w,h,{account:P,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new M(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});w=P,A&&p.addInstruction(A);let{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new M(t.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});h=k,B&&p.addInstruction(B);let T=[];for(let E of t.rewardDefaultInfos){let V=o.useSOLBalance&&E.mint.address===ee.toString(),v;if(E.mint.address===t.mintA.address)v=w;else if(E.mint.address===t.mintB.address)v=h;else{let{account:Ce,instructionParams:ve}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(E.mint.programId),mint:new M(E.mint.address),notUseTokenAccount:V,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!V,associatedOnly:V?!1:u,checkCreateATAOwner:l});v=Ce,ve&&p.addInstruction(ve)}T.push(v)}!w&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let x=n!=null?n:await this.getClmmPoolKeys(t.id),N=(L=await this.scope.connection.getAccountInfo(i.nftMint))==null?void 0:L.owner.equals(Rt),S=await le.decreaseLiquidityInstructions({poolInfo:t,poolKeys:x,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:h,rewardAccounts:T},liquidity:c,amountMinA:s,amountMinB:a,nft2022:N});p.addInstruction({instructions:S.instructions,instructionTypes:[se.ClmmDecreasePosition]});let K=F({},S.address);if(o.closePosition){let E=await le.closePositionInstructions({poolInfo:t,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:i,nft2022:N});p.addInstruction({endInstructions:E.instructions,endInstructionTypes:E.instructionTypes}),K=F(F({},K),E.address)}return p.addCustomComputeBudget(m),p.addTipInstruction(f),p.versionBuild({txVersion:d,extInfo:{address:K}})}async lockPosition(e){var g;let{programId:t=Vt,authProgramId:n=An,poolProgramId:i=qt,ownerPosition:o,payer:s,computeBudgetConfig:a,txTipConfig:c,txVersion:u,getEphemeralSigners:l,feePayer:m}=e,f=this.createTxBuilder(m),d=await le.makeLockPositions({programId:t,authProgramId:n,poolProgramId:i,wallet:this.scope.ownerPubKey,payer:s!=null?s:this.scope.ownerPubKey,nftMint:o.nftMint,getEphemeralSigners:l,nft2022:(g=await this.scope.connection.getAccountInfo(o.nftMint))==null?void 0:g.owner.equals(Rt)});return f.addInstruction(d),f.addCustomComputeBudget(a),f.addTipInstruction(c),f.versionBuild({txVersion:u,extInfo:d.address})}async harvestLockPosition(e){let{programId:t=Vt,authProgramId:n=An,clmmProgram:i=qt,poolKeys:o,lockData:s,ownerInfo:a={useSOLBalance:!0},associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txTipConfig:m,txVersion:f,feePayer:d}=e,g=o||await this.getClmmPoolKeys(s.poolId.toString()),p=this.createTxBuilder(d),y=await this.scope.connection.getAccountInfo(s.positionId);y||this.logger.logWithError("position not found",s.positionId);let b=rn.decode(y.data),w=a.useSOLBalance&&g.mintA.address===ee.toString(),h=a.useSOLBalance&&g.mintB.address===ee.toString(),P,A,{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.mintA.programId,mint:new M(g.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,associatedOnly:w?!1:c,checkCreateATAOwner:u});P=k,B&&p.addInstruction(B);let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.mintB.programId,mint:new M(g.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,associatedOnly:h?!1:c,checkCreateATAOwner:u});A=T,x&&p.addInstruction(x);let N={},S=[];for(let he of g.rewardInfos){let De=a.useSOLBalance&&he.mint.address===ee.toString(),xt=N[he.mint.address];if(!xt){let{account:Cr,instructionParams:bi}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(he.mint.programId),mint:new M(he.mint.address),notUseTokenAccount:De,owner:this.scope.ownerPubKey,skipCloseAccount:!De,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:De?!1:c});xt=Cr,bi&&p.addInstruction(bi)}N[he.mint.address]=xt,S.push(xt)}let K=$t(t,s.lockNftMint).publicKey,L=ae(this.scope.ownerPubKey,s.lockNftMint,sn).publicKey,E=O.getTickArrayStartIndexByTick(b.tickLower,g.config.tickSpacing),V=O.getTickArrayStartIndexByTick(b.tickUpper,g.config.tickSpacing),{publicKey:v}=Q(new M(g.programId),s.poolId,E),{publicKey:Ce}=Q(new M(g.programId),s.poolId,V),{publicKey:ve}=Ze(new M(g.programId),s.poolId,b.tickLower,b.tickUpper),tt=[];for(let he=0;he<g.rewardInfos.length;he++)tt.push({poolRewardVault:new M(g.rewardInfos[he].vault),ownerRewardVault:S[he],rewardMint:new M(g.rewardInfos[he].mint.address)});let Tt=await le.harvestLockPositionInstructionV2({programId:t,auth:n,lockPositionId:K,clmmProgram:i,lockOwner:this.scope.ownerPubKey,lockNftMint:s.lockNftMint,lockNftAccount:L,positionNftAccount:s.nftAccount,positionId:s.positionId,poolId:s.poolId,protocolPosition:ve,vaultA:new M(g.vault.A),vaultB:new M(g.vault.B),tickArrayLower:v,tickArrayUpper:Ce,userVaultA:P,userVaultB:A,mintA:new M(g.mintA.address),mintB:new M(g.mintB.address),rewardAccounts:tt,exTickArrayBitmap:we(i,s.poolId).publicKey});return p.addInstruction({instructions:[Tt],instructionTypes:[se.ClmmHarvestLockPosition]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:f})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:i,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){var m;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let c=this.createTxBuilder(a),u=t!=null?t:await this.getClmmPoolKeys(e.id),l=le.closePositionInstructions({poolInfo:e,poolKeys:u,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n,nft2022:(m=await this.scope.connection.getAccountInfo(n.nftMint))==null?void 0:m.owner.equals(Rt)});return c.addCustomComputeBudget(o),c.addTipInstruction(s),c.addInstruction(l).versionBuild({txVersion:i,extInfo:{address:l.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a,feePayer:c}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(c),l=t.useSOLBalance&&n.mint.address.toString()===ee.toString(),m=n.perSecond.mul(n.endTime-n.openTime),{account:f,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(n.mint.address),mint:new M(n.mint.address),notUseTokenAccount:!!l,skipCloseAccount:!l,owner:this.scope.ownerPubKey,createInfo:l?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new R(m.toFixed(0)).gte(m)?m.toFixed(0):m.add(1).toFixed(0))}:void 0,associatedOnly:l?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=await this.getClmmPoolKeys(e.id),p=le.initRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{programId:new M(n.mint.programId),mint:new M(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:U.decimalToX64(n.perSecond)}});return u.addInstruction(p),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:p.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txTipConfig:c,txVersion:u,feePayer:l}){for(let d of i)d.endTime<=d.openTime&&this.logAndCreateError("reward time error","rewardInfo",d);let m=this.createTxBuilder(l),f={};for(let d of i){let g=n.useSOLBalance&&d.mint.address===ee.toString(),p=d.perSecond.mul(d.endTime-d.openTime),{account:y,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(d.mint.programId),mint:new M(d.mint.address),notUseTokenAccount:!!g,skipCloseAccount:!g,owner:this.scope.ownerPubKey,createInfo:g?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Fe(new R(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:g?!1:o,checkCreateATAOwner:s});b&&m.addInstruction(b),y||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let w=t!=null?t:await this.getClmmPoolKeys(e.id),h=le.initRewardInstructions({poolInfo:e,poolKeys:w,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:y},rewardInfo:{programId:new M(d.mint.programId),mint:new M(d.mint.address),openTime:d.openTime,endTime:d.endTime,emissionsPerSecondX64:U.decimalToX64(d.perSecond)}});f=F(F({},f),h.address),m.addInstruction(h)}return m.addCustomComputeBudget(a),m.addTipInstruction(c),m.versionBuild({txVersion:u,extInfo:{address:f}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txTipConfig:a,txVersion:c,feePayer:u}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let l=this.createTxBuilder(u),m=t.useSOLBalance&&n.mint.equals(ee),{account:f,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new R(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});d&&l.addInstruction(d),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=await this.getClmmPoolKeys(e.id),p=le.setRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:U.decimalToX64(n.perSecond)}});return l.addInstruction(p),l.addCustomComputeBudget(s),l.addTipInstruction(a),l.versionBuild({txVersion:c,extInfo:{address:p.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txTipConfig:c,txVersion:u,feePayer:l}){let m=this.createTxBuilder(l),f={};for(let d of i){d.endTime<=d.openTime&&this.logAndCreateError("reward time error","rewardInfo",d);let g=n.useSOLBalance&&d.mint.address===ee.toString(),{account:p,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(d.mint.programId),mint:new M(d.mint.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:g?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Fe(new R(d.perSecond.sub(d.endTime-d.openTime).toFixed(0)).gte(d.perSecond.sub(d.endTime-d.openTime))?d.perSecond.sub(d.endTime-d.openTime).toFixed(0):d.perSecond.sub(d.endTime-d.openTime).add(1).toFixed(0))}:void 0,associatedOnly:g?!1:o,checkCreateATAOwner:s});y&&m.addInstruction(y),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=t!=null?t:await this.getClmmPoolKeys(e.id),w=le.setRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new M(d.mint.address),openTime:d.openTime,endTime:d.endTime,emissionsPerSecondX64:U.decimalToX64(d.perSecond)}});m.addInstruction(w),f=F(F({},f),w.address)}return m.addCustomComputeBudget(a),m.addTipInstruction(c),m.versionBuild({txVersion:u,extInfo:{address:f}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txTipConfig:a,txVersion:c,feePayer:u}){let l=e.rewardDefaultInfos.find(b=>b.mint.address===n.toString());l||this.logAndCreateError("reward mint error","not found reward mint",n);let m=this.createTxBuilder(u),f=t.useSOLBalance&&n.equals(ee),{account:d,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(l.mint.programId),mint:n,notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:i,checkCreateATAOwner:o});g&&m.addInstruction(g),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),y=le.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardMint:n});return m.addInstruction(y),m.addCustomComputeBudget(s),m.addTipInstruction(a),m.versionBuild({txVersion:c,extInfo:{address:y.address}})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l={};for(let m of n){let f=e.rewardDefaultInfos.find(w=>w.mint.address===m.toString());if(!f){this.logAndCreateError("reward mint error","not found reward mint",m);continue}let d=t.useSOLBalance&&m.equals(ee),{account:g,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(f.mint.programId),mint:m,notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!d,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:i,checkCreateATAOwner:o});g||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),p&&u.addInstruction(p);let y=await this.getClmmPoolKeys(e.id),b=le.collectRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:g},rewardMint:m});u.addInstruction(b),l=F(F({},l),b.address)}return u.addCustomComputeBudget(s),u.addTipInstruction(a),u.build({address:l})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:i,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:f,computeBudgetConfig:d,txTipConfig:g,feePayer:p}){let y=this.createTxBuilder(p),b=n.toString()===e.mintA.address,w=c.useSOLBalance&&e.mintA.address===ee.toBase58(),h=c.useSOLBalance&&e.mintB.address===ee.toBase58(),P;!s||s.equals(new R(0))?P=b?Je.add(new Fe(1)):$e.sub(new Fe(1)):P=q.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let A;if(!A){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new M(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,skipCloseAccount:!w,createInfo:w||!b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?i:0}:void 0,associatedOnly:w?!1:l,checkCreateATAOwner:m});A=T,x&&y.addInstruction(x)}let k;if(!k){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new M(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,skipCloseAccount:!h,createInfo:h||b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?0:i}:void 0,associatedOnly:h?!1:l,checkCreateATAOwner:m});k=T,x&&y.addInstruction(x)}(!A||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:A,ownerTokenAccountB:k,mintAUseSOLBalance:w,mintBUseSOLBalance:h,associatedOnly:l});let B=t!=null?t:await this.getClmmPoolKeys(e.id);return y.addInstruction(le.makeSwapBaseInInstructions({poolInfo:e,poolKeys:B,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:A,tokenAccountB:k},inputMint:new M(n),amountIn:i,amountOutMin:o,sqrtPriceLimitX64:P,remainingAccounts:u})),y.addCustomComputeBudget(d),y.addTipInstruction(g),y.versionBuild({txVersion:f})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:i,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:f,computeBudgetConfig:d,txTipConfig:g,feePayer:p}){let y=this.createTxBuilder(p),b=n.toString()===e.mintB.address,w=c.useSOLBalance&&e.mintA.address===ee.toBase58(),h=c.useSOLBalance&&e.mintB.address===ee.toBase58(),P;!s||s.equals(new R(0))?P=n.toString()===e.mintB.address?Je.add(new Fe(1)):$e.sub(new Fe(1)):P=q.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let A;if(!A){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new M(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,skipCloseAccount:!w,createInfo:w||!b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?o:0}:void 0,associatedOnly:w?!1:l,checkCreateATAOwner:m});A=T,x&&y.addInstruction(x)}let k;if(!k){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new M(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,skipCloseAccount:!h,createInfo:h||b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?0:o}:void 0,associatedOnly:h?!1:l,checkCreateATAOwner:m});k=T,x&&y.addInstruction(x)}(!A||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:A,ownerTokenAccountB:k,mintAUseSOLBalance:w,mintBUseSOLBalance:h,associatedOnly:l});let B=t!=null?t:await this.getClmmPoolKeys(e.id);return y.addInstruction(le.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:B,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:A,tokenAccountB:k},outputMint:new M(n),amountOut:i,amountInMax:o,sqrtPriceLimitX64:P,remainingAccounts:u})),y.addCustomComputeBudget(d),y.addTipInstruction(g),y.versionBuild({txVersion:f})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u,feePayer:l}){var y,b;let m={};for(let w of this.scope.account.tokenAccountRawInfos)o?ae(this.scope.ownerPubKey,w.accountInfo.mint,a).publicKey.equals(w.pubkey)&&(m[w.accountInfo.mint.toString()]=w.pubkey):m[w.accountInfo.mint.toString()]=w.pubkey;let f=Object.values(t).flat().map(w=>w.nftMint),d=await rt(this.scope.connection,f.map(w=>({pubkey:w}))),g={};d.forEach(w=>{var h,P;g[w.pubkey.toBase58()]=(P=(h=w==null?void 0:w.accountInfo)==null?void 0:h.owner)!=null?P:null});let p=this.createTxBuilder(l);for(let w of Object.values(e)){if(t[w.id]===void 0||!t[w.id].find(S=>!S.liquidity.isZero()||S.rewardInfos.find(K=>!K.rewardAmountOwed.isZero())))continue;let h=w,P=i.useSOLBalance&&h.mintA.address===ee.toString(),A=i.useSOLBalance&&h.mintB.address===ee.toString(),k=m[h.mintA.address];if(!k){let{account:S,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:h.mintA.programId,mint:new M(h.mintA.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:o,checkCreateATAOwner:s});k=S,K&&p.addInstruction(K)}let B=m[h.mintB.address];if(!B){let{account:S,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:h.mintB.programId,mint:new M(h.mintB.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,skipCloseAccount:!A,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:A?!1:o,checkCreateATAOwner:s});B=S,K&&p.addInstruction(K)}m[h.mintA.address]=k,m[h.mintB.address]=B;let T=[];for(let S of h.rewardDefaultInfos){let K=i.useSOLBalance&&S.mint.address===ee.toString(),L=m[S.mint.address];if(!L){let{account:E,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new M(S.mint.programId),mint:new M(S.mint.address),notUseTokenAccount:K,owner:this.scope.ownerPubKey,skipCloseAccount:!K,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:K?!1:o});L=E,V&&p.addInstruction(V)}m[S.mint.address]=L,T.push(L)}let x=await this.getClmmPoolKeys(h.id),N=[];for(let S=0;S<x.rewardInfos.length;S++)N.push({poolRewardVault:new M(x.rewardInfos[S].vault),ownerRewardVault:T[S],rewardMint:new M(x.rewardInfos[S].mint.address)});for(let S of t[w.id]){let K=(y=n==null?void 0:n[w.id])==null?void 0:y[S.nftMint.toBase58()];if(K){let L=ae(this.scope.ownerPubKey,K.lockNftMint,sn).publicKey,E=O.getTickArrayStartIndexByTick(S.tickLower,x.config.tickSpacing),V=O.getTickArrayStartIndexByTick(S.tickUpper,x.config.tickSpacing),{publicKey:v}=Q(new M(x.programId),K.poolId,E),{publicKey:Ce}=Q(new M(x.programId),K.poolId,V),{publicKey:ve}=Ze(new M(x.programId),K.poolId,S.tickLower,S.tickUpper),tt=$t(Vt,K.lockNftMint).publicKey,Tt=le.harvestLockPositionInstructionV2({programId:Vt,auth:An,lockPositionId:tt,clmmProgram:qt,lockOwner:this.scope.ownerPubKey,lockNftMint:K.lockNftMint,lockNftAccount:L,positionNftAccount:K.nftAccount,positionId:K.positionId,poolId:K.poolId,protocolPosition:ve,vaultA:new M(x.vault.A),vaultB:new M(x.vault.B),tickArrayLower:v,tickArrayUpper:Ce,userVaultA:k,userVaultB:B,mintA:new M(x.mintA.address),mintB:new M(x.mintB.address),rewardAccounts:N,exTickArrayBitmap:we(qt,K.poolId).publicKey});p.addInstruction({instructions:[Tt],instructionTypes:[se.ClmmHarvestLockPosition],lookupTableAddress:x.lookupTableAccount?[x.lookupTableAccount]:[]})}else{let L=le.decreaseLiquidityInstructions({poolInfo:h,poolKeys:x,ownerPosition:S,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:k,tokenAccountB:B,rewardAccounts:T},liquidity:new Fe(0),amountMinA:new Fe(0),amountMinB:new Fe(0),nft2022:(b=g[S.nftMint.toBase58()])==null?void 0:b.equals(Rt)});p.addInstruction(L)}}}return c===0?p.sizeCheckBuildV0({computeBudgetConfig:u}):p.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Jt(e).publicKey);return t?Ar.decode(t.data).whitelistMints.filter(i=>!i.equals(M.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Fe(1))).map(s=>Oe(new M(e),s.accountInfo.mint).publicKey),i=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return i.forEach(s=>{if(!s)return;let a=rn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await rt(this.scope.connection,e.map(o=>({pubkey:new M(o)})),t),i={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=Rn.decode(s.accountInfo.data),c=q.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();i[String(e[o])]=j(F({},a),{currentPrice:c,programId:s.accountInfo.owner})}return i}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),i=await rt(this.scope.connection,Array.from(n).map(c=>({pubkey:new M(c)}))),o={};i.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=kr.decode(c.accountInfo.data))});let s=await pe.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,f,d,g;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:Sn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||sn.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?ni((f=t[u])==null?void 0:f.feeConfig):void 0}}),mintB:Sn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||sn.toBase58(),extensions:{feeConfig:(d=t[l])!=null&&d.feeConfig?ni((g=t[l])==null?void 0:g.feeConfig):void 0}}),price:e[c].currentPrice,config:j(F({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await pe.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),i=await vi({connection:this.scope.connection,mints:Array.from(n).map(m=>new M(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:i}),a=await rt(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=wr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(Ir.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(Ir.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=j(F({},o[e]),{exBitmapAccount:o[e].exBitmapAccount.toBase58(),observationId:o[e].observationId.toBase58(),id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},config:c.config,rewardInfos:o[e].rewardInfos.filter(m=>!m.tokenVault.equals(M.default)).map(m=>({mint:Sn({address:m.tokenMint.toBase58(),programId:sn.toBase58(),decimals:10}),vault:m.tokenVault.toBase58()}))});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{Sr as Clmm};
//# sourceMappingURL=clmm.mjs.map